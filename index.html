<!DOCTYPE html>
<html lang="zh-Hant" data-lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- SEO Meta Tags -->
  <title>🐱🐶 MBTI Animal Personality Test | Find Your Spirit Animal | 發現最像你的性格動物</title>
  <meta name="description" content="Discover your spirit animal through MBTI personality test! Find whether you're more like a cat or dog based on Myers-Briggs personality assessment. Free online personality quiz with cute animals. 透過MBTI性格測驗找到最像你的動物夥伴！">
  <meta name="keywords" content="MBTI test, personality test, animal personality, cat personality, dog personality, Myers-Briggs, psychological test, free personality quiz, spirit animal, personality assessment, zodiac signs, astrology, pet compatibility, cute animals, funny quiz, viral test, social media quiz, online game, entertainment, fun activities, mental health, self-discovery, character analysis, personality types, introvert, extrovert, psychology quiz, animal lover, pet quiz, 人格測驗, MBTI測試, 性格測試, 動物性格, 貓咪性格, 狗狗性格, 心理測驗, 免費性格測驗, 精神動物, 性格評估, 星座, 占星, 寵物相容性, 可愛動物, 有趣測驗, 病毒測試, 社交媒體測驗, 線上遊戲, 娛樂, 有趣活動, 心理健康, 自我發現, 性格分析, 性格類型, 內向, 外向, 心理測驗, 動物愛好者, 寵物測驗, プレソナリティテスト, 性格診断, 動物占い, 猫の性格, 犬の性格, MBTI診断, 심리테스트, 성격테스트, 동물성격, 고양이성격, 강아지성격, MBTI검사, test de personalidad, personalidad animal, personalidad de gatos, personalidad de perros, prueba MBTI">
  <meta name="author" content="MBTI Animal Personality">
  <meta name="robots" content="index, follow">
  <meta name="language" content="zh-TW, en-US">
  
  <!-- Additional SEO Meta Tags -->
  <meta name="rating" content="general">
  <meta name="distribution" content="global">
  <meta name="revisit-after" content="7 days">
  <meta name="classification" content="Entertainment, Psychology, Animals, Quiz">
  <meta name="audience" content="general">
  <meta name="copyright" content="MBTI Animal Personality Test">
  
  <!-- Geo Meta Tags -->
  <meta name="geo.region" content="TW">
  <meta name="geo.country" content="Taiwan">
  <meta name="ICBM" content="25.0330, 121.5654">
  <meta name="geo.position" content="25.0330;121.5654">
  <meta name="geo.placename" content="Taiwan">
  
  <!-- Alternative Languages -->
  <link rel="alternate" hreflang="zh-TW" href="">
  <link rel="alternate" hreflang="en-US" href="">
  <link rel="alternate" hreflang="x-default" href="">
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="🐱🐶 MBTI Animal Personality Test | Find Your Spirit Animal">
  <meta property="og:description" content="Discover your spirit animal through MBTI personality test! Find whether you're more like a cat or dog based on your personality.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="">
  <meta property="og:image" content="android-chrome-512x512.png">
  <meta property="og:image:width" content="512">
  <meta property="og:image:height" content="512">
  <meta property="og:locale" content="zh_TW">
  <meta property="og:locale:alternate" content="en_US">
  <meta property="og:site_name" content="MBTI Animal Personality Test">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="🐱🐶 MBTI Animal Personality Test">
  <meta name="twitter:description" content="Discover your spirit animal through MBTI personality test!">
  <meta name="twitter:image" content="android-chrome-512x512.png">
  
  <!-- Favicon Links -->
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  <link rel="shortcut icon" href="favicon.ico">
  
  <!-- Additional SEO -->
  <link rel="canonical" href="">
  <meta name="theme-color" content="#D2B48C">
  <meta name="msapplication-TileColor" content="#D2B48C">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="MBTI Animal Test">
  
  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebApplication",
    "name": "MBTI Animal Personality Test",
    "alternateName": "發現最像你的性格動物",
    "description": "Discover your spirit animal through MBTI personality test. Free online personality quiz with cute animals. Find whether you're more like a cat or dog based on Myers-Briggs personality assessment.",
    "url": "",
    "applicationCategory": "Entertainment",
    "operatingSystem": "Any",
    "browserRequirements": "Requires JavaScript. Requires HTML5.",
    "softwareVersion": "1.0",
    "datePublished": "2025-08-04",
    "dateModified": "2025-08-04",
    "inLanguage": ["zh-TW", "en-US"],
    "keywords": "MBTI, personality test, animal personality, cat, dog, Myers-Briggs, psychological test, free quiz, spirit animal",
    "audience": {
      "@type": "Audience",
      "audienceType": "general public"
    },
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD",
      "availability": "https://schema.org/InStock"
    },
    "author": {
      "@type": "Organization",
      "name": "MBTI Animal Personality",
      "url": ""
    },
    "publisher": {
      "@type": "Organization",
      "name": "MBTI Animal Personality",
      "url": ""
    },
    "image": {
      "@type": "ImageObject",
      "url": "android-chrome-512x512.png",
      "width": 512,
      "height": 512
    },
    "screenshot": {
      "@type": "ImageObject",
      "url": "android-chrome-512x512.png"
    },
    "featureList": [
      "MBTI Personality Assessment",
      "Animal Personality Matching",
      "Zodiac Sign Integration",
      "Multi-language Support",
      "Social Media Sharing",
      "Result Image Download"
    ],
    "isAccessibleForFree": true,
    "sameAs": []
  }
  </script>
  
  <!-- Additional Structured Data for Quiz -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Quiz",
    "name": "MBTI Animal Personality Test",
    "description": "A fun personality quiz that matches you with your spirit animal based on MBTI personality types",
    "about": {
      "@type": "Thing",
      "name": "Personality Psychology"
    },
    "educationalLevel": "beginner",
    "learningResourceType": "quiz",
    "interactivityType": "active",
    "isAccessibleForFree": true,
    "inLanguage": ["zh-TW", "en-US"]
  }
  </script>
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;600;700&family=Kalam:wght@300;400;700&family=Caveat:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    :root {
      /* 奶茶色系配色 */
      --gradient-primary: linear-gradient(135deg, #D2B48C 0%, #BC9A6A 100%);
      --gradient-secondary: linear-gradient(135deg, #F4A7B9 0%, #E8A598 100%);
      --gradient-accent: linear-gradient(135deg, #D4C4A8 0%, #D4C4A8 100%);
      --gradient-warm: linear-gradient(135deg, #F5E6D3 0%, #E8D5B7 100%);
      --bg-color: #FDF6E3;
      --card-bg: rgba(252, 248, 227, 0.9);
      --text-primary: #8B4513;
      --text-secondary: #A0522D;
      --text-accent: #D2691E;
      --border-color: rgba(210, 180, 140, 0.3);
      --shadow-soft: 0 8px 32px rgba(139, 69, 19, 0.1);
      --shadow-hover: 0 15px 35px rgba(139, 69, 19, 0.15);
      --milktea-light: #F7F3E9;
      --milktea-medium: #E6D7C3;
      --milktea-dark: #D2B48C;
      --pink-accent: #F4A7B9;
      --khaki-accent: #C3B091;
      --border-radius: 20px;
      --animation-speed: 0.3s;
    }

    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      line-height: 1.6;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    .container {
      width: 100%;
      max-width: 680px;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-soft);
      padding: 40px 30px;
      position: relative;
      overflow: hidden;
      animation: slideUp 0.8s ease-out;
    }
    
    /* 電腦版容器優化 */
    @media (min-width: 769px) {
      .container {
        max-width: 800px;
        padding: 50px 40px;
      }
      
      .header h1 {
        font-size: 3.5rem !important;
      }
      
      .header .subtitle {
        font-size: 1.3rem !important;
      }
      
      .question p {
        font-size: 1.4rem !important;
      }
      
      .submit-button {
        font-size: 1.4rem !important;
        padding: 18px 0 !important;
      }
    }
    
    /* 平板版容器優化 */
    @media (min-width: 481px) and (max-width: 768px) {
      .container {
        max-width: 720px;
        padding: 45px 35px;
      }
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
    }

    .container::after {
      content: '✨';
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 1.2rem;
      opacity: 0.7;
      animation: sparkle 2s ease-in-out infinite;
    }

    @keyframes sparkle {
      0%, 100% { opacity: 0.7; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-family: 'Caveat', 'Noto Sans TC', cursive;
      font-size: clamp(2rem, 4vw, 3rem);
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px;
      letter-spacing: -0.02em;
      position: relative;
    }

    .header h1::after {
      content: '～';
      position: absolute;
      right: -10px;
      top: -5px;
      color: var(--pink-accent);
      font-size: 0.8em;
      opacity: 0.8;
    }

    .header .subtitle {
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 1.1rem;
      color: var(--text-secondary);
      font-weight: 400;
      opacity: 0;
      animation: fadeIn 1s ease-out 0.3s forwards;
      position: relative;
    }

    .header .subtitle::before {
      content: '♡';
      margin-right: 8px;
      color: var(--pink-accent);
    }

    .header .subtitle::after {
      content: '♡';
      margin-left: 8px;
      color: var(--pink-accent);
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--milktea-light);
      border-radius: 4px;
      margin-bottom: 30px;
      overflow: hidden;
      box-shadow: inset 0 2px 4px rgba(139, 69, 19, 0.1);
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient-primary);
      width: 0%;
      transition: width 0.5s ease-out;
      border-radius: 4px;
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .question {
      background: var(--milktea-light);
      backdrop-filter: blur(10px);
      border: 2px solid var(--border-color);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-soft);
      transition: all var(--animation-speed) ease;
      opacity: 0;
      transform: translateY(20px);
      animation: questionSlideIn 0.6s ease-out forwards;
      position: relative;
      overflow: hidden;
    }

    .question::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--gradient-secondary);
      opacity: 0.6;
    }

    .question:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
      border-color: var(--pink-accent);
    }

    @keyframes questionSlideIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .question-number {
      display: inline-block;
      width: 28px;
      height: 28px;
      background: var(--gradient-primary);
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 28px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-right: 12px;
    }

    .question p {
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 1.2rem;
      font-weight: 500;
      margin-bottom: 16px;
      color: var(--text-primary);
    }

    .options-grid {
      display: grid;
      gap: 12px;
    }

    /* 星座問題專用樣式 */
    .zodiac-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    
    .zodiac-option {
      padding: 12px 8px;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .zodiac-option .option-content {
      font-size: 0.9rem;
      text-align: center;
      padding: 4px;
      line-height: 1.3;
      padding-left: 4px !important;
    }
    
    .zodiac-option .option-content::before {
      display: none;
    }

    /* 平板版星座優化 */
    @media (min-width: 481px) and (max-width: 768px) {
      .zodiac-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 6px;
      }
      
      .zodiac-option .option-content {
        font-size: 0.8rem;
      }
    }

    /* 手機版星座選項優化 */
    @media (max-width: 480px) {
      .zodiac-grid {
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 6px !important;
      }
      
      .zodiac-option {
        padding: 10px 6px !important;
        min-height: 55px !important;
      }
      
      .zodiac-option .option-content {
        font-size: 0.8rem !important;
        line-height: 1.2 !important;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 100%;
      }
    }

    /* 極小螢幕優化 */
    @media (max-width: 360px) {
      .zodiac-option .option-content {
        font-size: 0.75rem !important;
      }
    }

    .option {
      position: relative;
      background: var(--card-bg);
      border: 2px solid var(--milktea-medium);
      border-radius: 12px;
      padding: 16px 20px;
      cursor: pointer;
      transition: all var(--animation-speed) ease;
      backdrop-filter: blur(5px);
    }

    .option:hover {
      background: var(--milktea-light);
      border-color: var(--pink-accent);
      transform: translateX(4px);
      box-shadow: 0 4px 12px rgba(244, 167, 185, 0.3);
    }

    .option input[type="radio"] {
      position: absolute;
      opacity: 0;
      width: 0;
      height: 0;
    }

    .option input[type="radio"]:checked + .option-content {
      background: var(--gradient-secondary);
      color: white;
      border-radius: 8px;
    }

    .option input[type="radio"]:checked + .option-content::before {
      transform: scale(1);
      opacity: 1;
      color: white;
    }

    .option-content {
      position: relative;
      display: flex;
      align-items: center;
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-weight: 500;
      padding-left: 35px;
      transition: all var(--animation-speed) ease;
      border-radius: 8px;
      padding: 12px 16px 12px 45px;
    }

    .option-content::before {
      content: '♡';
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%) scale(0);
      opacity: 0;
      transition: all var(--animation-speed) ease;
      font-weight: bold;
      color: var(--pink-accent);
    }

    .submit-button {
      width: 100%;
      padding: 16px 0;
      background: var(--gradient-primary);
      border: none;
      border-radius: 16px;
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 1.2rem;
      font-weight: 600;
      color: white;
      cursor: pointer;
      box-shadow: var(--shadow-soft);
      transition: all var(--animation-speed) ease;
      margin-top: 20px;
      position: relative;
      overflow: hidden;
    }

    .submit-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.5s;
    }

    .submit-button:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: var(--shadow-hover);
    }

    .submit-button:hover::before {
      left: 100%;
    }

    .submit-button:disabled {
      background: var(--khaki-accent);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      opacity: 0.7;
    }

    .result {
      margin-top: 30px;
      padding: 0;
      background: transparent;
      border: none;
      border-radius: 0;
      box-shadow: none;
      opacity: 0;
      animation: resultFadeIn 0.8s ease-out forwards;
    }

    /* IG Stories 風格結果卡片 - 自適應高度版本 */
    .ig-result-card {
      background: linear-gradient(145deg, #ffffff 0%, #fefcf7 100%);
      border-radius: 18px;
      padding: 20px;
      box-shadow: 
        0 12px 30px rgba(0, 0, 0, 0.06),
        0 4px 15px rgba(244, 167, 185, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(244, 167, 185, 0.15);
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      max-width: 400px;
      min-height: auto; /* 移除固定高度 */
      width: 100%;
    }

    /* 電腦版優化 - 更大的結果顯示 */
    @media (min-width: 769px) {
      .ig-result-card {
        max-width: 500px;
        padding: 30px;
      }
      
      .result-emoji {
        font-size: 4rem !important;
      }
      
      .result-title {
        font-size: 2.2rem !important;
      }
      
      .result-pet-name {
        font-size: 2rem !important;
      }
      
      .result-description {
        font-size: 1.2rem !important;
        padding: 0 15px !important;
        margin-bottom: 20px !important;
      }
      
      .result-mbti-badge {
        font-size: 1.3rem !important;
        padding: 18px 36px !important;
        margin-bottom: 25px !important;
      }
      
      .similar-title {
        font-size: 1rem !important;
        margin-bottom: 15px !important;
      }
      
      .mini-animal-emoji {
        font-size: 1.8rem !important;
      }
      
      .mini-animal-name {
        font-size: 0.8rem !important;
        max-width: 100px !important;
      }
      
      .connection-text {
        font-size: 0.9rem !important;
        margin-bottom: 10px !important;
      }
      
      .connection-tag {
        font-size: 0.75rem !important;
        padding: 6px 10px !important;
      }
      
      .similar-animals, .social-connection {
        padding: 15px !important;
        margin: 10px 0 !important;
      }
    }

    /* 平板端優化 */
    @media (min-width: 481px) and (max-width: 768px) {
      .ig-result-card {
        max-width: 450px;
        padding: 25px;
      }
      
      .result-emoji {
        font-size: 3.5rem !important;
      }
      
      .result-title {
        font-size: 1.9rem !important;
      }
      
      .result-pet-name {
        font-size: 1.7rem !important;
      }
      
      .result-description {
        font-size: 1.1rem !important;
      }
    }

    /* 手機端優化 */
    @media (max-width: 480px) {
      .ig-result-card {
        max-width: 90vw;
        min-height: auto; /* 自適應高度 */
        padding: 20px 15px;
      }
      
      .result-emoji {
        font-size: 3rem !important;
      }
      
      .result-title {
        font-size: 1.7rem !important;
      }
      
      .result-pet-name {
        font-size: 1.5rem !important;
      }
      
      .result-description {
        font-size: 1rem !important;
        margin-bottom: 15px !important;
      }
      
      .result-mbti-badge {
        font-size: 1.1rem !important;
        padding: 14px 28px !important;
        margin-bottom: 20px !important;
      }
      
      .similar-animals, .social-connection {
        padding: 12px !important;
        margin: 8px 0 !important;
      }
    }

    /* 確保內容不會溢出 */
    .ig-result-card * {
      box-sizing: border-box;
    }

    .ig-result-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: linear-gradient(90deg, #FF6B6B, #4ECDC4, #45B7D1, #96CEB4, #FFEAA7, #DDA0DD);
      background-size: 300% 300%;
      animation: gradientShift 3s ease infinite;
    }

    /* Stories 風格頭部 */
    .stories-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding: 10px 0;
    }

    .stories-profile {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stories-avatar {
      width: 40px;
      height: 40px;
      background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      color: white;
      font-weight: bold;
    }

    .stories-info h4 {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .stories-info p {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.75rem;
      color: #8e8e93;
      margin: 0;
    }

    .stories-time {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.75rem;
      color: #8e8e93;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .result-header {
      text-align: center;
      margin-bottom: 20px;
      position: relative;
      flex-shrink: 0;
    }

    .result-emoji-container {
      position: relative;
      display: inline-block;
      margin-bottom: 15px;
    }

    .result-emoji {
      font-size: 2.8rem;
      position: relative;
      z-index: 2;
      animation: float 3s ease-in-out infinite;
    }

    .emoji-glow {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80px;
      height: 80px;
      background: radial-gradient(circle, rgba(244, 167, 185, 0.3) 0%, transparent 70%);
      border-radius: 50%;
      animation: pulse-glow 2s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes pulse-glow {
      0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.6; }
      50% { transform: translate(-50%, -50%) scale(1.2); opacity: 0.8; }
    }

    .result-title {
      font-family: 'Caveat', 'Noto Sans TC', cursive;
      font-size: 1.6rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px;
      line-height: 1.2;
    }

    .result-pet-name {
      font-family: 'Caveat', 'Noto Sans TC', cursive;
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 15px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .result-description {
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 0.9rem;
      line-height: 1.5;
      color: var(--text-secondary);
      text-align: center;
      margin-bottom: 20px;
      padding: 0 8px;
      flex-shrink: 0;
    }

    .result-mbti-badge {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 50px;
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 25px;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
      position: relative;
      overflow: hidden;
      border: 2px solid rgba(255, 255, 255, 0.3);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .result-mbti-badge::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shine 2s infinite;
    }

    @keyframes shine {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    /* 相似動物展示區 */
    .similar-animals {
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      border-radius: 10px;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid rgba(102, 126, 234, 0.1);
      flex-shrink: 0;
    }

    .similar-title {
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-primary);
      text-align: center;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .animal-row {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin: 8px 0;
      gap: 8px;
    }

    .mini-animal {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      flex: 1;
      text-align: center;
      min-width: 0;
    }

    .mini-animal-emoji {
      font-size: 1.3rem;
      animation: bounce-subtle 2s ease-in-out infinite;
    }

    .mini-animal-name {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.6rem;
      font-weight: 500;
      color: var(--text-secondary);
      line-height: 1.1;
      max-width: 70px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .mini-animal-type {
      font-size: 0.5rem;
      color: #8e8e93;
      font-weight: 400;
      line-height: 1;
    }

    @keyframes bounce-subtle {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-3px); }
    }

    /* 互動連結區 */
    .social-connection {
      background: linear-gradient(135deg, rgba(244, 167, 185, 0.1) 0%, rgba(210, 180, 140, 0.1) 100%);
      border-radius: 10px;
      padding: 10px;
      margin: 10px 0;
      text-align: center;
      border: 1px solid rgba(244, 167, 185, 0.2);
      flex-shrink: 0;
    }

    .connection-text {
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 0.7rem;
      color: var(--text-secondary);
      margin-bottom: 8px;
      line-height: 1.3;
    }

    .connection-tags {
      display: flex;
      justify-content: center;
      gap: 4px;
      flex-wrap: wrap;
    }

    .connection-tag {
      background: rgba(102, 126, 234, 0.1);
      color: var(--text-primary);
      padding: 3px 8px;
      border-radius: 8px;
      font-size: 0.6rem;
      font-weight: 500;
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
    }

    /* Stories 風格頭部 */
    .stories-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 16px 16px 0 0;
      margin: -16px -16px 10px -16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .stories-profile {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stories-avatar {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .stories-info {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .stories-username {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.75rem;
      font-weight: 600;
      color: white;
      line-height: 1;
    }

    .stories-time {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.65rem;
      color: rgba(255, 255, 255, 0.7);
      line-height: 1;
    }

    .stories-options {
      color: rgba(255, 255, 255, 0.8);
      font-size: 1rem;
      cursor: pointer;
      padding: 3px;
      border-radius: 50%;
      transition: background-color 0.2s ease;
    }

    .stories-options:hover {
      background-color: rgba(255, 255, 255, 0.1);
    }

    /* 滾動區域樣式 */
    .scrollable-content {
      scrollbar-width: thin;
      scrollbar-color: rgba(244, 167, 185, 0.3) transparent;
    }

    .scrollable-content::-webkit-scrollbar {
      width: 3px;
    }

    .scrollable-content::-webkit-scrollbar-track {
      background: transparent;
    }

    .scrollable-content::-webkit-scrollbar-thumb {
      background: rgba(244, 167, 185, 0.3);
      border-radius: 2px;
    }

    .scrollable-content::-webkit-scrollbar-thumb:hover {
      background: rgba(244, 167, 185, 0.5);
    }

    .share-section {
      background: linear-gradient(135deg, rgba(244, 167, 185, 0.1) 0%, rgba(210, 180, 140, 0.1) 100%);
      border-radius: 12px;
      padding: 10px;
      margin-top: 8px;
      text-align: center;
      border: 1px solid rgba(244, 167, 185, 0.2);
      display: none; /* 隱藏內部分享區域 */
    }
    
    /* 外部分享區域樣式 */
    .external-share-section {
      background: linear-gradient(135deg, rgba(244, 167, 185, 0.08) 0%, rgba(210, 180, 140, 0.08) 100%);
      border-radius: 16px;
      padding: 20px;
      margin-top: 20px;
      text-align: center;
      border: 1px solid rgba(244, 167, 185, 0.15);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 15px rgba(244, 167, 185, 0.1);
    }
    
    .external-share-title {
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .share-buttons-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-bottom: 15px;
    }
    
    .share-btn-external {
      background: white;
      border: 2px solid var(--milktea-medium);
      border-radius: 12px;
      padding: 12px 16px;
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      text-decoration: none;
    }
    
    .share-btn-external:hover {
      background: var(--milktea-light);
      border-color: var(--pink-accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(244, 167, 185, 0.3);
    }
    
    .share-btn-external:active {
      transform: translateY(0);
    }
    
    .download-btn {
      background: var(--gradient-primary) !important;
      color: white !important;
      border-color: transparent !important;
    }
    
    .download-btn:hover {
      background: var(--gradient-secondary) !important;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    .share-subtitle {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 15px;
      opacity: 0.8;
    }
    
    /* 手機版分享按鈕優化 */
    @media (max-width: 480px) {
      .share-buttons-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }
      
      .share-btn-external {
        padding: 10px 12px;
        font-size: 0.8rem;
      }
      
      .external-share-title {
        font-size: 1.1rem;
      }
    }

    .share-title {
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 0.8rem;
      color: var(--text-primary);
      text-align: center;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .share-buttons {
      display: flex;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
      margin-bottom: 0;
    }

    .share-btn {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      border: none;
      border-radius: 15px;
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.65rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .share-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }

    .share-btn.instagram {
      background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%);
      color: white;
    }

    .share-btn.facebook {
      background: #1877f2;
      color: white;
    }

    .share-btn.twitter {
      background: #1da1f2;
      color: white;
    }

    .share-btn.line {
      background: #00c300;
      color: white;
    }

    .share-btn.copy {
      background: linear-gradient(135deg, var(--gradient-secondary));
      color: white;
    }

    .explore-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 15px;
      color: white;
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: hidden;
    }

    .explore-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .explore-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 35px rgba(102, 126, 234, 0.4);
    }

    .explore-btn:hover::before {
      left: 100%;
    }

    /* 裝飾元素 */
    .decorative-hearts {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 1.2rem;
      opacity: 0.6;
      animation: twinkle 2s ease-in-out infinite;
    }

    .decorative-sparkles {
      position: absolute;
      bottom: 20px;
      left: 20px;
      font-size: 1rem;
      opacity: 0.5;
      animation: twinkle 2s ease-in-out infinite 1s;
    }

    /* 響應式設計 */
    @media (max-width: 768px) {
      .ig-result-card {
        padding: 30px 20px;
        margin: 0 10px;
      }
      
      .result-emoji {
        font-size: 3.5rem;
      }
      
      .result-title {
        font-size: 1.8rem;
      }
      
      .result-pet-name {
        font-size: 1.6rem;
      }
      
      .share-buttons {
        gap: 8px;
      }
      
      .share-btn {
        padding: 8px 12px;
        font-size: 0.8rem;
      }
    }

    @keyframes resultFadeIn {
      to {
        opacity: 1;
      }
    }

    .result h2 {
      font-family: 'Caveat', 'Noto Sans TC', cursive;
      font-size: 2rem;
      font-weight: 700;
      background: var(--gradient-secondary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 16px;
      text-align: center;
      position: relative;
    }

    .result h2::before {
      content: '✧';
      position: absolute;
      left: -40px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--pink-accent);
      font-size: 1.5rem;
      animation: twinkle 2s ease-in-out infinite;
    }

    .result h2::after {
      content: '✧';
      position: absolute;
      right: -40px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--pink-accent);
      font-size: 1.5rem;
      animation: twinkle 2s ease-in-out infinite 0.5s;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.6; transform: translateY(-50%) scale(0.8); }
      50% { opacity: 1; transform: translateY(-50%) scale(1.2); }
    }

    .result-pet {
      text-align: center;
      font-size: 3rem;
      margin: 20px 0;
    }

    .result-desc {
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 1.1rem;
      line-height: 1.8;
      color: var(--text-secondary);
      text-align: center;
    }

    /* 響應式設計 */
    @media (max-width: 768px) {
      .container {
        padding: 30px 20px;
        margin: 10px;
      }
      
      .question {
        padding: 20px;
      }
      
      .option-content {
        padding: 10px 12px 10px 40px;
        font-size: 0.95rem;
      }

      .result h2::before,
      .result h2::after {
        display: none;
      }

      .header h1::after {
        right: -5px;
        font-size: 0.6em;
      }
    }

    /* 音效和回饋效果 */
    .option.clicked {
      animation: pulse 0.3s ease-out;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .submit-button.clicked {
      animation: buttonPress 0.4s ease-out;
    }

    @keyframes buttonPress {
      0% { transform: translateY(-2px) scale(1.02); }
      50% { transform: translateY(2px) scale(0.98); }
      100% { transform: translateY(-2px) scale(1.02); }
    }

    .question.answered {
      border-color: var(--pink-accent);
      box-shadow: 0 0 20px rgba(244, 167, 185, 0.4);
    }

    .floating-hearts {
      position: absolute;
      pointer-events: none;
      color: var(--pink-accent);
      font-size: 1.5rem;
      animation: floatUp 2s ease-out forwards;
    }

    @keyframes floatUp {
      0% { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
      100% { 
        opacity: 0; 
        transform: translateY(-50px) scale(0.5); 
      }
    }

    .progress-celebration {
      position: relative;
      overflow: visible;
    }

    .progress-celebration::after {
      content: '🎉';
      position: absolute;
      top: -30px;
      right: 0;
      font-size: 1.5rem;
      opacity: 0;
      animation: celebrate 0.8s ease-out;
    }

    @keyframes celebrate {
      0% { opacity: 0; transform: translateY(10px) scale(0.5); }
      50% { opacity: 1; transform: translateY(-10px) scale(1.2); }
      100% { opacity: 0; transform: translateY(-20px) scale(0.8); }
    }

    .result-entrance {
      animation: resultEntrance 1s ease-out;
    }

    @keyframes resultEntrance {
      0% { 
        opacity: 0; 
        transform: translateY(50px) scale(0.8); 
      }
      50% { 
        opacity: 0.8; 
        transform: translateY(-10px) scale(1.05); 
      }
      100% { 
        opacity: 1; 
        transform: translateY(0) scale(1); 
      }
    }

    @keyframes bounce {
      0%, 20%, 53%, 80%, 100% {
        transform: translate(0, 0);
      }
      40%, 43% {
        transform: translate(0, -15px);
      }
      70% {
        transform: translate(0, -7px);
      }
      90% {
        transform: translate(0, -3px);
      }
    }

    /* 探索更多區域樣式 */
    .explore-more {
      margin-top: 40px;
      padding: 30px;
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-soft);
      opacity: 0;
      animation: resultFadeIn 0.8s ease-out forwards;
    }

    .explore-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .explore-header h2 {
      font-family: 'Caveat', 'Noto Sans TC', cursive;
      font-size: 2rem;
      font-weight: 700;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
    }

    .explore-header p {
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    .filter-section {
      margin-bottom: 30px;
    }

    .filter-group {
      margin-bottom: 20px;
    }

    .filter-label {
      display: block;
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 1.1rem;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 10px;
    }

    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .filter-btn {
      padding: 8px 16px;
      border: 2px solid var(--milktea-medium);
      background: var(--card-bg);
      border-radius: 20px;
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-primary);
      cursor: pointer;
      transition: all var(--animation-speed) ease;
      backdrop-filter: blur(5px);
    }

    .filter-btn:hover {
      background: var(--milktea-light);
      border-color: var(--pink-accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(244, 167, 185, 0.3);
    }

    .filter-btn.active {
      background: var(--gradient-secondary);
      border-color: var(--pink-accent);
      color: white;
      box-shadow: 0 4px 12px rgba(244, 167, 185, 0.4);
    }

    .animal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .animal-card {
      background: var(--milktea-light);
      border: 2px solid var(--border-color);
      border-radius: 16px;
      padding: 20px;
      transition: all var(--animation-speed) ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .animal-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--gradient-secondary);
      opacity: 0.6;
    }

    .animal-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-hover);
      border-color: var(--pink-accent);
    }

    .card-header {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .card-emoji {
      font-size: 2rem;
      margin-right: 12px;
    }

    .card-title {
      flex: 1;
    }

    .card-species {
      font-family: 'Caveat', 'Noto Sans TC', cursive;
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
    }

    .card-mbti {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      font-size: 0.9rem;
      color: var(--text-accent);
      font-weight: 500;
    }

    .card-element {
      background: var(--gradient-accent);
      color: var(--text-primary);
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
      white-space: nowrap;
    }

    .card-description {
      font-family: 'Kalam', 'Noto Sans TC', cursive;
      font-size: 1rem;
      line-height: 1.6;
      color: var(--text-secondary);
      margin-top: 12px;
    }

    .card-match {
      position: absolute;
      top: 15px;
      right: 15px;
      background: var(--gradient-secondary);
      color: white;
      padding: 4px 8px;
      border-radius: 8px;
      font-size: 0.7rem;
      font-weight: 600;
      opacity: 0;
      transform: scale(0);
      transition: all var(--animation-speed) ease;
    }

    .animal-card.perfect-match .card-match {
      opacity: 1;
      transform: scale(1);
    }

    @media (max-width: 768px) {
      .filter-buttons {
        flex-direction: column;
      }
      
      .filter-btn {
        text-align: center;
      }
      
      .animal-grid {
        grid-template-columns: 1fr;
      }
      
      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .card-element {
        align-self: flex-start;
      }
    }

    /* Language Switcher Styles */
    .language-switcher {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      gap: 8px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 25px;
      padding: 8px;
      border: 1px solid var(--border-color);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .lang-btn {
      padding: 8px 16px;
      border: none;
      background: transparent;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-secondary);
      transition: all 0.3s ease;
      position: relative;
      white-space: nowrap;
    }

    .lang-btn:hover {
      background: rgba(210, 180, 140, 0.2);
      color: var(--text-primary);
    }

    .lang-btn.active {
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 2px 8px rgba(210, 180, 140, 0.3);
    }

    .lang-btn.active::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: var(--gradient-primary);
      border-radius: 22px;
      z-index: -1;
      opacity: 0.3;
    }

    /* Mobile language switcher */
    @media (max-width: 768px) {
      .language-switcher {
        top: 15px;
        right: 15px;
        padding: 6px;
      }

      .lang-btn {
        padding: 6px 12px;
        font-size: 0.8rem;
      }
    }

    /* Multi-language content visibility */
    [data-lang="zh-TW"] [data-en] {
      display: none;
    }

    [data-lang="zh-TW"] [data-zh] {
      display: initial;
    }

    [data-lang="en-US"] [data-zh] {
      display: none;
    }

    [data-lang="en-US"] [data-en] {
      display: initial;
    }

    /* Inline elements */
    [data-lang="zh-TW"] .inline [data-en] {
      display: none;
    }

    [data-lang="zh-TW"] .inline [data-zh] {
      display: inline;
    }

    [data-lang="en-US"] .inline [data-zh] {
      display: none;
    }

    [data-lang="en-US"] .inline [data-en] {
      display: inline;
    }
  </style>
</head>
<body>
  <!-- Language Switcher -->
  <div class="language-switcher">
    <button class="lang-btn active" onclick="switchLanguage('zh-TW')" data-lang-code="zh-TW">
      <span data-zh>繁中</span>
      <span data-en>繁中</span>
    </button>
    <button class="lang-btn" onclick="switchLanguage('en-US')" data-lang-code="en-US">
      <span data-zh>English</span>
      <span data-en>English</span>
    </button>
  </div>

  <div class="container">
    <div class="header">
      <h1 class="inline">
        <span data-zh>🐱🐶 發現最像你的性格動物</span>
        <span data-en>🐱🐶 Discover Your Spirit Animal</span>
      </h1>
      <p class="subtitle">
        <span data-zh>透過 MBTI 性格測驗，找到和你最相似的貓貓或狗狗</span>
        <span data-en>Find your perfect animal match through MBTI personality test</span>
      </p>
    </div>
    
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>

    <form id="quizForm">
      <div class="question" style="animation-delay: 0.1s">
        <p class="inline">
          <span class="question-number">1</span>
          <span data-zh>你通常在聚會中會怎麼做？</span>
          <span data-en>What do you usually do at parties?</span>
        </p>
        <div class="options-grid">
          <label class="option">
            <input type="radio" name="q1" value="E">
            <div class="option-content inline">
              <span data-zh>🎉 喜歡和朋友互動，享受熱鬧氛圍</span>
              <span data-en>🎉 Love interacting with friends and enjoying the lively atmosphere</span>
            </div>
          </label>
          <label class="option">
            <input type="radio" name="q1" value="I">
            <div class="option-content inline">
              <span data-zh>🤔 喜歡獨自思考，觀察周圍環境</span>
              <span data-en>🤔 Prefer thinking alone and observing the surroundings</span>
            </div>
          </label>
        </div>
      </div>

      <div class="question" style="animation-delay: 0.2s">
        <p class="inline">
          <span class="question-number">2</span>
          <span data-zh>你在做決策時較傾向：</span>
          <span data-en>When making decisions, you tend to:</span>
        </p>
        <div class="options-grid">
          <label class="option">
            <input type="radio" name="q2" value="S">
            <div class="option-content inline">
              <span data-zh>📊 注重實際細節和具體事實</span>
              <span data-en>📊 Focus on practical details and concrete facts</span>
            </div>
          </label>
          <label class="option">
            <input type="radio" name="q2" value="N">
            <div class="option-content inline">
              <span data-zh>💭 憑直覺和想像力思考</span>
              <span data-en>💭 Think with intuition and imagination</span>
            </div>
          </label>
        </div>
      </div>

      <div class="question" style="animation-delay: 0.3s">
        <p class="inline">
          <span class="question-number">3</span>
          <span data-zh>你做決定時較看重：</span>
          <span data-en>When making decisions, you value more:</span>
        </p>
        <div class="options-grid">
          <label class="option">
            <input type="radio" name="q3" value="T">
            <div class="option-content inline">
              <span data-zh>🧠 邏輯分析與客觀判斷</span>
              <span data-en>🧠 Logical analysis and objective judgment</span>
            </div>
          </label>
          <label class="option">
            <input type="radio" name="q3" value="F">
            <div class="option-content inline">
              <span data-zh>❤️ 情感考量與價值觀念</span>
              <span data-en>❤️ Emotional considerations and values</span>
            </div>
          </label>
        </div>
      </div>

      <div class="question" style="animation-delay: 0.4s">
        <p class="inline">
          <span class="question-number">4</span>
          <span data-zh>你偏好的生活方式：</span>
          <span data-en>Your preferred lifestyle:</span>
        </p>
        <div class="options-grid">
          <label class="option">
            <input type="radio" name="q4" value="J">
            <div class="option-content inline">
              <span data-zh>📅 計畫有序，喜歡確定性</span>
              <span data-en>📅 Organized and planned, prefer certainty</span>
            </div>
          </label>
          <label class="option">
            <input type="radio" name="q4" value="P">
            <div class="option-content inline">
              <span data-zh>🎭 隨性彈性，保持開放態度</span>
              <span data-en>🎭 Flexible and spontaneous, keep an open attitude</span>
            </div>
          </label>
        </div>
      </div>

      <div class="question" style="animation-delay: 0.5s">
        <p class="inline">
          <span class="question-number">5</span>
          <span data-zh>你是哪個星座？</span>
          <span data-en>What's your zodiac sign?</span>
        </p>
        <div class="options-grid zodiac-grid">
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="aries">
            <div class="option-content inline">
              <span data-zh>♈ 牡羊座</span>
              <span data-en>♈ Aries</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="taurus">
            <div class="option-content inline">
              <span data-zh>♉ 金牛座</span>
              <span data-en>♉ Taurus</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="gemini">
            <div class="option-content inline">
              <span data-zh>♊ 雙子座</span>
              <span data-en>♊ Gemini</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="cancer">
            <div class="option-content inline">
              <span data-zh>♋ 巨蟹座</span>
              <span data-en>♋ Cancer</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="leo">
            <div class="option-content inline">
              <span data-zh>♌ 獅子座</span>
              <span data-en>♌ Leo</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="virgo">
            <div class="option-content inline">
              <span data-zh>♍ 處女座</span>
              <span data-en>♍ Virgo</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="libra">
            <div class="option-content inline">
              <span data-zh>♎ 天秤座</span>
              <span data-en>♎ Libra</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="scorpio">
            <div class="option-content inline">
              <span data-zh>♏ 天蠍座</span>
              <span data-en>♏ Scorpio</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="sagittarius">
            <div class="option-content inline">
              <span data-zh>♐ 射手座</span>
              <span data-en>♐ Sagittarius</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="capricorn">
            <div class="option-content inline">
              <span data-zh>♑ 摩羯座</span>
              <span data-en>♑ Capricorn</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="aquarius">
            <div class="option-content inline">
              <span data-zh>♒ 水瓶座</span>
              <span data-en>♒ Aquarius</span>
            </div>
          </label>
          <label class="option zodiac-option">
            <input type="radio" name="q5" value="pisces">
            <div class="option-content inline">
              <span data-zh>♓ 雙魚座</span>
              <span data-en>♓ Pisces</span>
            </div>
          </label>
        </div>
      </div>

      <button type="button" class="submit-button" id="submitBtn" disabled>
        <span id="btnText" class="inline">
          <span data-zh>請完成所有題目</span>
          <span data-en>Please complete all questions</span>
        </span>
      </button>
    </form>

    <div id="result" class="result" style="display: none;"></div>
    
    <!-- 探索更多相似動物區域 -->
    <div id="exploreMore" class="explore-more" style="display: none;">
      <div class="explore-header">
        <h2 class="inline">
          <span data-zh>🔍 探索更多相似的毛孩</span>
          <span data-en>🔍 Explore More Similar Pets</span>
        </h2>
        <p class="inline">
          <span data-zh>根據你的 MBTI 類型，發現更多個性相近的貓咪和狗狗</span>
          <span data-en>Based on your MBTI type, discover more cats and dogs with similar personalities</span>
        </p>
      </div>
      
      <div class="filter-section">
        <div class="filter-group">
          <label class="filter-label inline">
            <span data-zh>🧠 選擇 MBTI 象限：</span>
            <span data-en>🧠 Choose MBTI Group:</span>
          </label>
          <div class="filter-buttons">
            <button class="filter-btn" data-filter="all" data-type="mbti">
              <span class="inline">
                <span data-zh>全部</span>
                <span data-en>All</span>
              </span>
            </button>
            <button class="filter-btn" data-filter="analysts" data-type="mbti">
              <span class="inline">
                <span data-zh>理念型 (NT)</span>
                <span data-en>Analysts (NT)</span>
              </span>
            </button>
            <button class="filter-btn" data-filter="diplomats" data-type="mbti">
              <span class="inline">
                <span data-zh>外交型 (NF)</span>
                <span data-en>Diplomats (NF)</span>
              </span>
            </button>
            <button class="filter-btn" data-filter="sentinels" data-type="mbti">
              <span class="inline">
                <span data-zh>守護型 (SJ)</span>
                <span data-en>Sentinels (SJ)</span>
              </span>
            </button>
            <button class="filter-btn" data-filter="explorers" data-type="mbti">
              <span class="inline">
                <span data-zh>探險型 (SP)</span>
                <span data-en>Explorers (SP)</span>
              </span>
            </button>
          </div>
        </div>
        
        <div class="filter-group">
          <label class="filter-label inline">
            <span data-zh>⭐ 選擇星座元素：</span>
            <span data-en>⭐ Choose Zodiac Element:</span>
          </label>
          <div class="filter-buttons">
            <button class="filter-btn" data-filter="all" data-type="element">
              <span class="inline">
                <span data-zh>全部</span>
                <span data-en>All</span>
              </span>
            </button>
            <button class="filter-btn" data-filter="火象" data-type="element">
              <span class="inline">
                <span data-zh>🔥 火象</span>
                <span data-en>🔥 Fire</span>
              </span>
            </button>
            <button class="filter-btn" data-filter="土象" data-type="element">
              <span class="inline">
                <span data-zh>🌍 土象</span>
                <span data-en>🌍 Earth</span>
              </span>
            </button>
            <button class="filter-btn" data-filter="風象" data-type="element">
              <span class="inline">
                <span data-zh>💨 風象</span>
                <span data-en">💨 Air</span>
              </span>
            </button>
            <button class="filter-btn" data-filter="水象" data-type="element">
              <span class="inline">
                <span data-zh>💧 水象</span>
                <span data-en>💧 Water</span>
              </span>
            </button>
          </div>
        </div>
        
        <div class="filter-group">
          <label class="filter-label inline">
            <span data-zh>🐾 選擇動物類型：</span>
            <span data-en>🐾 Choose Animal Type:</span>
          </label>
          <div class="filter-buttons">
            <button class="filter-btn" data-filter="all" data-type="species">
              <span class="inline">
                <span data-zh>全部</span>
                <span data-en>All</span>
              </span>
            </button>
            <button class="filter-btn" data-filter="cats" data-type="species">
              <span class="inline">
                <span data-zh>🐱 貓咪</span>
                <span data-en>🐱 Cats</span>
              </span>
            </button>
            <button class="filter-btn" data-filter="dogs" data-type="species">
              <span class="inline">
                <span data-zh>🐶 狗狗</span>
                <span data-en>🐶 Dogs</span>
              </span>
            </button>
          </div>
        </div>
      </div>
      
      <div id="animalGrid" class="animal-grid"></div>
    </div>
  </div>

  <script>
    // 音效系統
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    
    // 動物數據存儲
    let animalData = [];
    let currentUserResult = null;
    
    // 載入動物數據
    async function loadAnimalData() {
      try {
        // 直接使用內嵌的動物數據，避免 CORS 問題
        animalData = [
          {"mbti": "ISTJ", "element": "fire", "species": "英國短毛貓", "description": "穩重卻偶爾熱情，給你安全感的守護者"},
          {"mbti": "ISTJ", "element": "earth", "species": "蘇格蘭摺耳貓", "description": "安靜乖巧，是穩定生活的最佳夥伴"},
          {"mbti": "ISTJ", "element": "air", "species": "美國短毛貓", "description": "理性中帶點靈活，能輕鬆應對變化"},
          {"mbti": "ISTJ", "element": "water", "species": "喜馬拉雅貓", "description": "內斂溫和，默默守護你"},
          {"mbti": "ISFJ", "element": "fire", "species": "布偶貓", "description": "熱情又親人，是最溫暖的治癒系夥伴"},
          {"mbti": "ISFJ", "element": "earth", "species": "波斯貓", "description": "高雅安靜，對你忠誠不渝"},
          {"mbti": "ISFJ", "element": "air", "species": "暹羅貓", "description": "機智貼心，總在身邊默默守護"},
          {"mbti": "ISFJ", "element": "water", "species": "緬因貓", "description": "巨大卻溫柔，給你滿滿安全感"},
          {"mbti": "INFJ", "element": "fire", "species": "阿比西尼亞貓", "description": "熱情且有領導氣質，內心卻浪漫深情"},
          {"mbti": "INFJ", "element": "earth", "species": "俄羅斯藍貓", "description": "優雅神秘，是內斂的理想主義者"},
          {"mbti": "INFJ", "element": "air", "species": "暹羅貓", "description": "創意無限，總有出其不意的點子"},
          {"mbti": "INFJ", "element": "water", "species": "緬甸貓", "description": "感情豐富，溫柔細膩，喜歡深度連結"},
          {"mbti": "INTJ", "element": "fire", "species": "孟加拉貓", "description": "野性十足，卻暗藏策略，是冒險家型思考者"},
          {"mbti": "INTJ", "element": "earth", "species": "異國短毛貓", "description": "穩重聰慧，冷靜計畫型人格"},
          {"mbti": "INTJ", "element": "air", "species": "暹羅貓", "description": "小巧靈活，擅長策略，掌握全局"},
          {"mbti": "INTJ", "element": "water", "species": "斯芬克斯貓", "description": "神秘冷酷，卻對親近的人展現柔情"},
          {"mbti": "ISTP", "element": "fire", "species": "孟加拉貓", "description": "精力旺盛，熱愛挑戰，總在行動中成長"},
          {"mbti": "ISTP", "element": "earth", "species": "日本短尾貓", "description": "靈活又穩定，熱愛自由卻不失規律"},
          {"mbti": "ISTP", "element": "air", "species": "美國短毛貓", "description": "反應敏捷，擅長用創意解決問題"},
          {"mbti": "ISTP", "element": "water", "species": "暹羅貓", "description": "感性中帶冒險，願意陪伴並探索世界"},
          {"mbti": "ISFP", "element": "fire", "species": "紅虎斑貓", "description": "熱情藝術家，總能讓生活充滿色彩"},
          {"mbti": "ISFP", "element": "earth", "species": "挪威森林貓", "description": "典雅又熱愛自然，像森林詩人般自由"},
          {"mbti": "ISFP", "element": "air", "species": "美國短毛貓", "description": "自由靈魂，擁有聰明的小腦袋"},
          {"mbti": "ISFP", "element": "water", "species": "布偶貓", "description": "柔情似水，總能給予安心與溫暖"},
          {"mbti": "INFP", "element": "fire", "species": "美國短毛貓", "description": "浪漫理想家，卻又熱情，像火焰般溫暖"},
          {"mbti": "INFP", "element": "earth", "species": "布偶貓", "description": "純真溫柔，給人最踏實的陪伴"},
          {"mbti": "INFP", "element": "air", "species": "康沃爾雷克斯貓", "description": "藝術靈魂，腦袋裡充滿奇妙點子"},
          {"mbti": "INFP", "element": "water", "species": "喜馬拉雅貓", "description": "情感豐富，最懂心靈深處的夢想家"},
          {"mbti": "INTP", "element": "fire", "species": "阿比西尼亞貓", "description": "聰明活潑，總有新奇創意，充滿冒險精神"},
          {"mbti": "INTP", "element": "earth", "species": "英國短毛貓", "description": "冷靜理智，是分析與穩定並存的完美典範"},
          {"mbti": "INTP", "element": "air", "species": "暹羅貓", "description": "聰明伶俐，觀察力超群，像小科學家一樣好奇心爆棚"},
          {"mbti": "INTP", "element": "water", "species": "俄羅斯藍貓", "description": "表面冷酷，內心柔情，感性與理性兼具"},
          {"mbti": "ESTJ", "element": "fire", "species": "德國牧羊犬", "description": "聰明且服從，天生的領導者，保護慾強"},
          {"mbti": "ESTJ", "element": "earth", "species": "拉布拉多", "description": "忠誠穩重，是最值得信任的夥伴"},
          {"mbti": "ESTJ", "element": "air", "species": "杜賓犬", "description": "反應敏捷、沉著冷靜，是策略型守護者"},
          {"mbti": "ESTJ", "element": "water", "species": "秋田犬", "description": "內斂忠心，保護慾極強，是沉穩的守護者"},
          {"mbti": "ESFJ", "element": "fire", "species": "黃金獵犬", "description": "熱情友善，帶給你滿滿陽光與正能量"},
          {"mbti": "ESFJ", "element": "earth", "species": "聖伯納犬", "description": "巨大卻溫柔，天然的守護天使，讓你安心"},
          {"mbti": "ESFJ", "element": "air", "species": "可卡犬", "description": "開朗愛玩，喜歡互動，是快樂小幫手"},
          {"mbti": "ESFJ", "element": "water", "species": "卡瓦利王查理獵犬", "description": "感情豐富，最愛窩在你懷裡，是溫柔黏人的伴侶"},
          {"mbti": "ENFJ", "element": "fire", "species": "邊境牧羊犬", "description": "聰明熱情，擅長帶領群體，活力滿滿"},
          {"mbti": "ENFJ", "element": "earth", "species": "伯恩山犬", "description": "溫柔可靠，天然的守護者，最有安全感"},
          {"mbti": "ENFJ", "element": "air", "species": "薩摩耶", "description": "微笑天使，樂觀活潑，傳遞快樂能量"},
          {"mbti": "ENFJ", "element": "water", "species": "愛爾蘭雪達犬", "description": "情感細膩，浪漫溫柔，熱愛深度連結"},
          {"mbti": "ENTJ", "element": "fire", "species": "羅威納犬", "description": "威嚴強大，懂得保護家人，行動力十足"},
          {"mbti": "ENTJ", "element": "earth", "species": "拳師犬", "description": "沉穩果斷，結合力量與柔和，是策略型行動家"},
          {"mbti": "ENTJ", "element": "air", "species": "德國賓沙犬", "description": "機敏聰慧，擅長掌控全局，冷靜又靈活"},
          {"mbti": "ENTJ", "element": "water", "species": "杜高犬", "description": "外剛內柔，重情重義，果敢且有溫度的守護者"},
          {"mbti": "ESTP", "element": "fire", "species": "西伯利亞哈士奇", "description": "冒險家，精力無窮，熱愛挑戰與探索"},
          {"mbti": "ESTP", "element": "earth", "species": "美國鬥牛犬", "description": "勇敢務實，行動果斷，穩健又可靠"},
          {"mbti": "ESTP", "element": "air", "species": "傑克羅素梗", "description": "機靈愛玩，總能帶來驚喜，是行動派小能手"},
          {"mbti": "ESTP", "element": "water", "species": "英國史賓格犬", "description": "愛冒險又黏人，溫柔感性，樂於分享愛與快樂"},
          {"mbti": "ESFP", "element": "fire", "species": "博美犬", "description": "活潑小明星，熱情開朗，享受舞台焦點"},
          {"mbti": "ESFP", "element": "earth", "species": "法國鬥牛犬", "description": "慵懶溫柔，愛撒嬌，是生活享樂專家"},
          {"mbti": "ESFP", "element": "air", "species": "比熊犬", "description": "開朗機靈，總能帶來好心情，是小太陽"},
          {"mbti": "ESFP", "element": "water", "species": "西施犬", "description": "溫柔親近，黏人小甜心，愛窩在你身邊"},
          {"mbti": "ENFP", "element": "fire", "species": "斑點狗", "description": "活力滿滿，愛玩愛冒險，天生的樂天派"},
          {"mbti": "ENFP", "element": "earth", "species": "柴犬", "description": "外冷內熱，個性鮮明，愛與人互動"},
          {"mbti": "ENFP", "element": "air", "species": "惠比特犬", "description": "反應快、喜愛互動，是生活的小驚喜"},
          {"mbti": "ENFP", "element": "water", "species": "比格犬", "description": "情感豐富，愛撒嬌，最喜歡和朋友在一起"},
          {"mbti": "ENTP", "element": "fire", "species": "柯基", "description": "外表呆萌，卻聰明伶俐，擅長活絡氣氛"},
          {"mbti": "ENTP", "element": "earth", "species": "牛頭梗", "description": "勇敢有個性，機智果斷，是忠誠守護者"},
          {"mbti": "ENTP", "element": "air", "species": "貴賓犬", "description": "智商第一，學習力驚人，還超級愛玩！"},
          {"mbti": "ENTP", "element": "water", "species": "蝴蝶犬", "description": "聰明靈巧，愛撒嬌，是迷人的小機靈"}
        ];
        
        console.log('動物數據載入成功:', animalData.length, '筆資料');
      } catch (error) {
        console.error('載入動物數據失敗:', error);
        // 如果載入失敗，使用備用數據
        animalData = generateFallbackData();
      }
    }
    
    // 備用數據（當無法載入 JSON 時使用）
    function generateFallbackData() {
      return [
        { mbti: 'ISTJ', element: 'fire', species: '英國短毛貓', description: '穩重卻偶爾熱情，給你安全感的守護者' },
        { mbti: 'ISFJ', element: 'fire', species: '布偶貓', description: '熱情又親人，是最溫暖的治癒系夥伴' },
        { mbti: 'ESTJ', element: 'fire', species: '德國牧羊犬', description: '聰明且服從，天生的領導者，保護慾強' },
        { mbti: 'ESFJ', element: 'fire', species: '黃金獵犬', description: '熱情友善，帶給你滿滿陽光與正能量' },
        { mbti: 'INTJ', element: 'earth', species: '異國短毛貓', description: '穩重聰慧，冷靜計畫型人格' },
        { mbti: 'INFJ', element: 'earth', species: '俄羅斯藍貓', description: '優雅神秘，是內斂的理想主義者' }
      ];
    }
    
    // MBTI 象限分類
    const mbtiGroups = {
      analysts: ['INTJ', 'INTP', 'ENTJ', 'ENTP'], // 理念型 (NT)
      diplomats: ['INFJ', 'INFP', 'ENFJ', 'ENFP'], // 外交型 (NF)
      sentinels: ['ISTJ', 'ISFJ', 'ESTJ', 'ESFJ'], // 守護型 (SJ)
      explorers: ['ISTP', 'ISFP', 'ESTP', 'ESFP']  // 探險型 (SP)
    };
    
    // 從 animals.json 找到對應 MBTI 和元素的動物
    function findAnimalByMbtiAndElement(mbti, element) {
      if (!animalData || animalData.length === 0) {
        console.log('動物資料尚未載入');
        return null;
      }
      
      // 先找完全匹配的 MBTI 和元素
      let result = animalData.find(animal => 
        animal.mbti === mbti && animal.element === element
      );
      
      console.log('尋找動物:', { mbti, element, found: !!result, result, animalDataLength: animalData.length });
      
      // 如果找不到完全匹配，只匹配 MBTI
      if (!result) {
        result = animalData.find(animal => animal.mbti === mbti);
        console.log('只匹配 MBTI，找到:', !!result);
      }
      
      // 如果還是找不到，找相近的 MBTI（同象限）
      if (!result) {
        const userGroup = Object.keys(mbtiGroups).find(group => 
          mbtiGroups[group].includes(mbti)
        );
        if (userGroup && mbtiGroups[userGroup]) {
          result = animalData.find(animal => 
            mbtiGroups[userGroup].includes(animal.mbti) && animal.element === element
          );
          console.log('匹配同象限和元素，找到:', !!result);
          
          if (!result) {
            result = animalData.find(animal => 
              mbtiGroups[userGroup].includes(animal.mbti)
            );
            console.log('只匹配同象限，找到:', !!result);
          }
        }
      }
      
      return result;
    }

    // 取得動物表情符號
    function getAnimalEmoji(species) {
      const cats = ['貓', 'Cat', 'cat'];
      const dogs = ['犬', '狗', 'Dog', 'dog'];
      
      if (cats.some(keyword => species.includes(keyword))) return '🐱';
      if (dogs.some(keyword => species.includes(keyword))) return '🐶';
      return '🐾';
    }
    
    // 星座對應元素
    function getZodiacElement(zodiac) {
      const zodiacElements = {
        'aries': 'fire',      // 牡羊座 - 火象
        'leo': 'fire',        // 獅子座 - 火象  
        'sagittarius': 'fire', // 射手座 - 火象
        'taurus': 'earth',    // 金牛座 - 土象
        'virgo': 'earth',     // 處女座 - 土象
        'capricorn': 'earth', // 摩羯座 - 土象
        'gemini': 'air',      // 雙子座 - 風象
        'libra': 'air',       // 天秤座 - 風象
        'aquarius': 'air',    // 水瓶座 - 風象
        'cancer': 'water',    // 巨蟹座 - 水象
        'scorpio': 'water',   // 天蠍座 - 水象
        'pisces': 'water'     // 雙魚座 - 水象
      };
      return zodiacElements[zodiac] || 'unknown';
    }
    
    // 星座中文名稱
    function getZodiacName(zodiac) {
      const zodiacNames = {
        'aries': '牡羊座',
        'taurus': '金牛座',
        'gemini': '雙子座', 
        'cancer': '巨蟹座',
        'leo': '獅子座',
        'virgo': '處女座',
        'libra': '天秤座',
        'scorpio': '天蠍座',
        'sagittarius': '射手座',
        'capricorn': '摩羯座',
        'aquarius': '水瓶座',
        'pisces': '雙魚座'
      };
      return zodiacNames[zodiac] || zodiac;
    }
    
    // 取得相似度評分
    function getSimilarityScore(animal, userMbti, userZodiac) {
      let score = 0;
      
      // MBTI 完全匹配
      if (animal.mbti === userMbti) score += 100;
      
      // MBTI 象限匹配
      const userGroup = Object.keys(mbtiGroups).find(group => 
        mbtiGroups[group].includes(userMbti)
      );
      const animalGroup = Object.keys(mbtiGroups).find(group => 
        mbtiGroups[group].includes(animal.mbti)
      );
      if (userGroup === animalGroup && animal.mbti !== userMbti) score += 60;
      
      // 星座匹配
      if (getZodiacElement(animal.zodiac) === getZodiacElement(userZodiac)) score += 40;
      
      // 其他部分匹配
      if (userMbti[0] === animal.mbti[0]) score += 20; // I/E 匹配
      if (userMbti[1] === animal.mbti[1]) score += 20; // S/N 匹配
      if (userMbti[2] === animal.mbti[2]) score += 20; // T/F 匹配
      if (userMbti[3] === animal.mbti[3]) score += 20; // J/P 匹配
      
      return score;
    }
    
    // 篩選動物數據
    function filterAnimals(mbtiFilter, elementFilter, speciesFilter) {
      let filtered = animalData;
      
      // MBTI 象限篩選
      if (mbtiFilter !== 'all') {
        if (mbtiGroups[mbtiFilter]) {
          filtered = filtered.filter(animal => 
            mbtiGroups[mbtiFilter].includes(animal.mbti)
          );
        }
      }
      
      // 星座元素篩選
      if (elementFilter !== 'all') {
        const elementMap = {
          '火象': 'fire',
          '土象': 'earth',
          '風象': 'air', 
          '水象': 'water'
        };
        const elementKey = elementMap[elementFilter];
        if (elementKey) {
          filtered = filtered.filter(animal => 
            animal.element === elementKey
          );
        }
      }
      
      // 動物類型篩選
      if (speciesFilter !== 'all') {
        if (speciesFilter === 'cats') {
          filtered = filtered.filter(animal => 
            ['貓', 'Cat', 'cat'].some(keyword => animal.species.includes(keyword))
          );
        } else if (speciesFilter === 'dogs') {
          filtered = filtered.filter(animal => 
            ['犬', '狗', 'Dog', 'dog'].some(keyword => animal.species.includes(keyword))
          );
        }
      }
      
      return filtered;
    }
    
    // 顯示動物卡片
    function displayAnimals(animals, userMbti = null, userZodiac = null) {
      const grid = document.getElementById('animalGrid');
      
      // 如果有使用者結果，按相似度排序
      if (userMbti && userZodiac) {
        animals = animals.map(animal => ({
          ...animal,
          similarity: getSimilarityScore(animal, userMbti, userZodiac)
        })).sort((a, b) => b.similarity - a.similarity);
      }
      
      grid.innerHTML = animals.map(animal => {
        const emoji = getAnimalEmoji(animal.species);
        const isPerfectMatch = userMbti && userZodiac && 
          animal.mbti === userMbti && getZodiacElement(animal.element) === getZodiacElement(userZodiac);
        
        // 轉換元素為中文顯示
        const elementMap = {
          'fire': '火象',
          'earth': '土象',
          'air': '風象',
          'water': '水象'
        };
        const elementDisplay = elementMap[animal.element] || animal.element;
        
        return `
          <div class="animal-card ${isPerfectMatch ? 'perfect-match' : ''}" onclick="playClickSound()">
            ${isPerfectMatch ? '<div class="card-match">完美匹配!</div>' : ''}
            <div class="card-header">
              <div class="card-emoji">${emoji}</div>
              <div class="card-title">
                <h3 class="card-species">${animal.species}</h3>
                <div class="card-mbti">${animal.mbti}</div>
              </div>
              <div class="card-element">${elementDisplay}</div>
            </div>
            <p class="card-description">${animal.description}</p>
          </div>
        `;
      }).join('');
      
      // 添加卡片出現動畫
      const cards = grid.querySelectorAll('.animal-card');
      cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        setTimeout(() => {
          card.style.transition = 'all 0.5s ease';
          card.style.opacity = '1';
          card.style.transform = 'translateY(0)';
        }, index * 100);
      });
    }
    
    // 設置篩選器事件監聽
    function setupFilters() {
      const filterBtns = document.querySelectorAll('.filter-btn');
      let currentFilters = {
        mbti: 'all',
        element: 'all',
        species: 'all'
      };
      
      filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
          const filterType = this.dataset.type;
          const filterValue = this.dataset.filter;
          
          // 更新同類型按鈕的狀態
          document.querySelectorAll(`[data-type="${filterType}"]`).forEach(b => 
            b.classList.remove('active')
          );
          this.classList.add('active');
          
          // 更新篩選條件
          currentFilters[filterType] = filterValue;
          
          // 播放點擊音效
          playClickSound();
          
          // 應用篩選
          const filtered = filterAnimals(
            currentFilters.mbti, 
            currentFilters.element, 
            currentFilters.species
          );
          
          displayAnimals(
            filtered, 
            currentUserResult?.mbti, 
            currentUserResult?.zodiac
          );
        });
      });
      
      // 設置默認選中狀態
      document.querySelectorAll('[data-filter="all"]').forEach(btn => {
        btn.classList.add('active');
      });
    }
    
    function playSound(frequency, duration, type = 'sine') {
      try {
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
        oscillator.type = type;
        
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
        
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + duration);
      } catch (e) {
        console.log('Audio not supported');
      }
    }

    function playClickSound() {
      playSound(800, 0.1, 'sine');
    }

    function playSuccessSound() {
      playSound(523, 0.2, 'sine'); // C5
      setTimeout(() => playSound(659, 0.2, 'sine'), 100); // E5
      setTimeout(() => playSound(784, 0.3, 'sine'), 200); // G5
    }

    function playCompletionSound() {
      const notes = [261, 329, 392, 523]; // C-E-G-C chord
      notes.forEach((note, index) => {
        setTimeout(() => playSound(note, 0.5, 'sine'), index * 100);
      });
    }

    // UI 回饋效果
    function createFloatingHearts(element) {
      for (let i = 0; i < 3; i++) {
        const heart = document.createElement('div');
        heart.className = 'floating-hearts';
        heart.textContent = '♡';
        heart.style.left = Math.random() * 50 + 'px';
        heart.style.animationDelay = i * 0.2 + 's';
        element.style.position = 'relative';
        element.appendChild(heart);
        
        setTimeout(() => heart.remove(), 2000);
      }
    }

    function addProgressCelebration() {
      const progressBar = document.querySelector('.progress-bar');
      progressBar.classList.add('progress-celebration');
      setTimeout(() => {
        progressBar.classList.remove('progress-celebration');
      }, 800);
    }

    // 進度條更新和表單驗證
    const form = document.getElementById('quizForm');
    const progressFill = document.getElementById('progressFill');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const totalQuestions = 5;

    function updateProgress() {
      const answeredQuestions = form.querySelectorAll('input[type="radio"]:checked').length;
      const progress = (answeredQuestions / totalQuestions) * 100;
      
      // 平滑動畫更新進度條
      progressFill.style.width = progress + '%';
      
      // 如果有進步，播放音效和動畫
      if (progress > 0) {
        playClickSound();
        if (progress === 100) {
          addProgressCelebration();
          playCompletionSound();
        }
      }
      
      if (answeredQuestions === totalQuestions) {
        submitBtn.disabled = false;
        submitBtn.style.background = 'var(--gradient-primary)';
        
        // Multi-language support for ready button
        const currentLang = document.documentElement.getAttribute('data-lang') || 'zh-TW';
        btnText.innerHTML = currentLang === 'en-US' ? 
          `<span data-zh>✨ 查看最像我的性格動物</span><span data-en>✨ Discover My Spirit Animal</span>` :
          `<span data-zh>✨ 查看最像我的性格動物</span><span data-en>✨ Discover My Spirit Animal</span>`;
        
        // 按鈕準備好的視覺效果
        submitBtn.style.animation = 'pulse 1s ease-in-out infinite';
      } else {
        submitBtn.disabled = true;
        submitBtn.style.background = 'var(--khaki-accent)';
        submitBtn.style.animation = 'none';
        
        // Multi-language support for incomplete button
        const currentLang = document.documentElement.getAttribute('data-lang') || 'zh-TW';
        const remaining = totalQuestions - answeredQuestions;
        btnText.innerHTML = currentLang === 'en-US' ? 
          `<span data-zh>還需回答 ${remaining} 個問題 ♡</span><span data-en>Need to answer ${remaining} more questions ♡</span>` :
          `<span data-zh>還需回答 ${remaining} 個問題 ♡</span><span data-en>Need to answer ${remaining} more questions ♡</span>`;
      }
    }

    // 為所有 radio 按鈕添加增強的事件監聽器
    form.querySelectorAll('input[type="radio"]').forEach(radio => {
      radio.addEventListener('change', function() {
        updateProgress();
        
        // 添加視覺回饋
        const option = this.closest('.option');
        const question = this.closest('.question');
        
        option.classList.add('clicked');
        question.classList.add('answered');
        
        // 創建浮動愛心效果
        createFloatingHearts(option);
        
        setTimeout(() => {
          option.classList.remove('clicked');
        }, 300);
      });

      // 添加懸停音效
      radio.closest('.option').addEventListener('mouseenter', function() {
        if (!this.querySelector('input').checked) {
          playSound(400, 0.05, 'sine');
        }
      });
    });

    // 增強的提交按鈕事件
    document.getElementById('submitBtn').addEventListener('click', function() {
      console.log('提交按鈕被點擊, disabled:', this.disabled);
      
      if (!this.disabled) {
        console.log('按鈕未被禁用，開始處理...');
        
        // 立即顯示結果，不依賴複雜的動畫或音效
        try {
          showResult();
          console.log('showResult 調用成功');
        } catch (error) {
          console.error('showResult 調用失敗:', error);
        }
        
        // 添加視覺反饋
        this.classList.add('clicked');
        setTimeout(() => {
          this.classList.remove('clicked');
        }, 400);
        
        // 嘗試播放音效
        try {
          playSuccessSound();
        } catch (e) {
          console.log('音效播放失敗:', e);
        }
      } else {
        console.log('按鈕被禁用，無法提交');
      }
    });

    // 測驗結果對應表
    const quizMapping = {
      ISTJ: {
        aries: {pet: '英國短毛貓', desc: '穩重中帶有牡羊座的勇敢直接，是值得信賴的守護者', emoji: '🐱'},
        taurus: {pet: '蘇格蘭摺耳貓', desc: '如金牛座般穩重踏實，是最安穩的陪伴', emoji: '🐱'},
        gemini: {pet: '美國短毛貓', desc: '理性中帶點雙子座的靈活機智', emoji: '🐱'},
        cancer: {pet: '喜馬拉雅貓', desc: '內斂溫和如巨蟹座，默默守護你', emoji: '🐱'},
        leo: {pet: '英國短毛貓', desc: '穩重卻有獅子座的自信魅力', emoji: '🐱'},
        virgo: {pet: '蘇格蘭摺耳貓', desc: '如處女座般注重細節，完美主義的夥伴', emoji: '🐱'},
        libra: {pet: '美國短毛貓', desc: '追求平衡和諧，理性優雅', emoji: '🐱'},
        scorpio: {pet: '喜馬拉雅貓', desc: '深沉神秘如天蠍座，忠誠守護', emoji: '🐱'},
        sagittarius: {pet: '英國短毛貓', desc: '穩重中帶有射手座的自由精神', emoji: '🐱'},
        capricorn: {pet: '蘇格蘭摺耳貓', desc: '如摩羯座般務實穩重，目標明確', emoji: '🐱'},
        aquarius: {pet: '美國短毛貓', desc: '獨立創新如水瓶座，思想前衛', emoji: '🐱'},
        pisces: {pet: '喜馬拉雅貓', desc: '浪漫夢幻如雙魚座，情感豐富', emoji: '🐱'}
      },
      ISFJ: {
        aries: {pet: '布偶貓', desc: '溫柔體貼中帶有牡羊座的行動力', emoji: '🐱'},
        taurus: {pet: '波斯貓', desc: '如金牛座般高雅穩重，忠誠不渝', emoji: '🐱'},
        gemini: {pet: '暹羅貓', desc: '機智貼心如雙子座，善解人意', emoji: '🐱'},
        cancer: {pet: '緬因貓', desc: '巨大卻溫柔如巨蟹座，給你安全感', emoji: '🐱'},
        leo: {pet: '布偶貓', desc: '熱情親人如獅子座，充滿魅力', emoji: '🐱'},
        virgo: {pet: '波斯貓', desc: '完美主義如處女座，追求完美的愛', emoji: '🐱'},
        libra: {pet: '暹羅貓', desc: '追求和諧平衡，溫柔體貼', emoji: '🐱'},
        scorpio: {pet: '緬因貓', desc: '深情專一如天蠍座，忠誠守護', emoji: '🐱'},
        sagittarius: {pet: '布偶貓', desc: '樂觀開朗如射手座，帶來快樂', emoji: '🐱'},
        capricorn: {pet: '波斯貓', desc: '穩重可靠如摩羯座，值得依靠', emoji: '🐱'},
        aquarius: {pet: '暹羅貓', desc: '獨特創新如水瓶座，與眾不同', emoji: '🐱'},
        pisces: {pet: '緬因貓', desc: '浪漫溫柔如雙魚座，情感細膩', emoji: '🐱'}
      },
      INFJ: {
        aries: {pet: '阿比西尼亞貓', desc: '理想主義中帶有牡羊座的勇氣', emoji: '🐱'},
        taurus: {pet: '俄羅斯藍貓', desc: '優雅神秘如金牛座般穩重', emoji: '🐱'},
        gemini: {pet: '暹羅貓', desc: '創意無限如雙子座，充滿想法', emoji: '🐱'},
        cancer: {pet: '緬甸貓', desc: '感情豐富如巨蟹座，溫柔細膩', emoji: '🐱'},
        leo: {pet: '阿比西尼亞貓', desc: '熱情領導如獅子座，內心浪漫', emoji: '🐱'},
        virgo: {pet: '俄羅斯藍貓', desc: '完美主義的理想家，追求完美', emoji: '🐱'},
        libra: {pet: '暹羅貓', desc: '追求平衡和諧的創意家', emoji: '🐱'},
        scorpio: {pet: '緬甸貓', desc: '深沉神秘如天蠍座，洞察人心', emoji: '🐱'},
        sagittarius: {pet: '阿比西尼亞貓', desc: '自由樂觀的理想主義者', emoji: '�'},
        capricorn: {pet: '俄羅斯藍貓', desc: '務實的理想家，腳踏實地', emoji: '�'},
        aquarius: {pet: '暹羅貓', desc: '獨立前衛的思想家', emoji: '�'},
        pisces: {pet: '緬甸貓', desc: '浪漫夢幻的理想主義者', emoji: '�'}
      },
      INTJ: {
        aries: {pet: '孟加拉貓', desc: '策略思維中帶有牡羊座的行動力', emoji: '�'},
        taurus: {pet: '異國短毛貓', desc: '穩重聰慧如金牛座，冷靜計畫', emoji: '�'},
        gemini: {pet: '暹羅貓', desc: '機智靈活的策略大師', emoji: '�'},
        cancer: {pet: '斯芬克斯貓', desc: '神秘冷酷中帶有巨蟹座的柔情', emoji: '🐱'},
        leo: {pet: '孟加拉貓', desc: '自信領導的策略家', emoji: '�'},
        virgo: {pet: '異國短毛貓', desc: '完美主義的計畫執行者', emoji: '🐱'},
        libra: {pet: '暹羅貓', desc: '追求平衡的理性思考者', emoji: '�'},
        scorpio: {pet: '斯芬克斯貓', desc: '深沉神秘的戰略家', emoji: '🐱'},
        sagittarius: {pet: '孟加拉貓', desc: '自由探索的獨立思考者', emoji: '�'},
        capricorn: {pet: '異國短毛貓', desc: '務實穩重的目標達成者', emoji: '�'},
        aquarius: {pet: '暹羅貓', desc: '獨立創新的未來規劃者', emoji: '🐱'},
        pisces: {pet: '斯芬克斯貓', desc: '直覺敏銳的夢想建築師', emoji: '�'}
      },
      ESTJ: {
        aries: {pet: '德國牧羊犬', desc: '天生領導如牡羊座，勇敢果決', emoji: '🐕'},
        taurus: {pet: '拉布拉多', desc: '忠誠穩重如金牛座，值得信任', emoji: '🐕'},
        gemini: {pet: '杜賓犬', desc: '機智敏捷的策略型領導者', emoji: '🐕'},
        cancer: {pet: '秋田犬', desc: '保護慾強如巨蟹座，忠心守護', emoji: '🐕'},
        leo: {pet: '德國牧羊犬', desc: '天生領袖如獅子座，威嚴有力', emoji: '🐕'},
        virgo: {pet: '拉布拉多', desc: '完美執行如處女座，注重細節', emoji: '🐕'},
        libra: {pet: '杜賓犬', desc: '公正平衡的優雅領導者', emoji: '🐕'},
        scorpio: {pet: '秋田犬', desc: '深沉堅定如天蠍座，意志堅強', emoji: '🐕'},
        sagittarius: {pet: '德國牧羊犬', desc: '自由勇敢的冒險領導者', emoji: '🐕'},
        capricorn: {pet: '拉布拉多', desc: '務實穩重如摩羯座，目標導向', emoji: '🐕'},
        aquarius: {pet: '杜賓犬', desc: '獨立創新的前瞻領導者', emoji: '🐕'},
        pisces: {pet: '秋田犬', desc: '溫柔堅定的感性領導者', emoji: '🐕'}
      },
      ESFJ: {
        aries: {pet: '黃金獵犬', desc: '熱情友善如牡羊座，充滿活力', emoji: '🐕'},
        taurus: {pet: '聖伯納犬', desc: '溫柔穩重如金牛座，安全感滿滿', emoji: '🐕'},
        gemini: {pet: '可卡犬', desc: '開朗機智如雙子座，社交高手', emoji: '🐕'},
        cancer: {pet: '卡瓦利王查理獵犬', desc: '溫柔體貼如巨蟹座，最愛陪伴', emoji: '🐕'},
        leo: {pet: '黃金獵犬', desc: '熱情陽光如獅子座，魅力四射', emoji: '🐕'},
        virgo: {pet: '聖伯納犬', desc: '完美照顧如處女座，無微不至', emoji: '🐕'},
        libra: {pet: '可卡犬', desc: '和諧友善的社交大師', emoji: '🐕'},
        scorpio: {pet: '卡瓦利王查理獵犬', desc: '深情專一如天蠍座，忠誠陪伴', emoji: '🐕'},
        sagittarius: {pet: '黃金獵犬', desc: '樂觀開朗如射手座，傳播快樂', emoji: '🐕'},
        capricorn: {pet: '聖伯納犬', desc: '穩重可靠如摩羯座，值得依靠', emoji: '🐕'},
        aquarius: {pet: '可卡犬', desc: '獨特友善的創新陪伴者', emoji: '🐕'},
        pisces: {pet: '卡瓦利王查理獵犬', desc: '浪漫溫柔如雙魚座，情感豐富', emoji: '🐕'}
      },
      // 為了簡化，其他 MBTI 類型使用通用邏輯，可根據需要擴展
      ISTP: {
        aries: {pet: '孟加拉貓', desc: '靈活獨立如牡羊座，充滿行動力', emoji: '🐱'},
        taurus: {pet: '日本短尾貓', desc: '穩重靈活，自由且規律', emoji: '🐱'},
        gemini: {pet: '美國短毛貓', desc: '機智靈活，善於解決問題', emoji: '🐱'},
        cancer: {pet: '暹羅貓', desc: '感性實用，陪伴探索', emoji: '🐱'},
        leo: {pet: '孟加拉貓', desc: '自信獨立，野性魅力', emoji: '🐱'},
        virgo: {pet: '日本短尾貓', desc: '完美主義的實用派', emoji: '🐱'},
        libra: {pet: '美國短毛貓', desc: '平衡理性的問題解決者', emoji: '🐱'},
        scorpio: {pet: '暹羅貓', desc: '深沉獨立的探險家', emoji: '🐱'},
        sagittarius: {pet: '孟加拉貓', desc: '自由探索的冒險者', emoji: '🐱'},
        capricorn: {pet: '日本短尾貓', desc: '務實穩重的獨立派', emoji: '🐱'},
        aquarius: {pet: '美國短毛貓', desc: '獨立創新的自由思考者', emoji: '🐱'},
        pisces: {pet: '暹羅貓', desc: '感性靈活的夢想實踐者', emoji: '🐱'}
      },
      ISFP: {
        aries: {pet: '紅虎斑貓', desc: '藝術熱情，充滿創意', emoji: '🐱'},
        taurus: {pet: '挪威森林貓', desc: '自然優雅，熱愛自由', emoji: '🐱'},
        gemini: {pet: '美國短毛貓', desc: '靈活創意，自由思考', emoji: '🐱'},
        cancer: {pet: '布偶貓', desc: '溫柔藝術，治癒心靈', emoji: '🐱'},
        leo: {pet: '紅虎斑貓', desc: '熱情藝術，色彩豐富', emoji: '🐱'},
        virgo: {pet: '挪威森林貓', desc: '完美自然的森林詩人', emoji: '🐱'},
        libra: {pet: '美國短毛貓', desc: '和諧優雅的自由創作者', emoji: '🐱'},
        scorpio: {pet: '布偶貓', desc: '深情溫柔的藝術靈魂', emoji: '🐱'},
        sagittarius: {pet: '紅虎斑貓', desc: '自由樂觀的色彩藝術家', emoji: '🐱'},
        capricorn: {pet: '挪威森林貓', desc: '穩重自然的實用藝術家', emoji: '🐱'},
        aquarius: {pet: '美國短毛貓', desc: '獨立創新的前衛藝術家', emoji: '🐱'},
        pisces: {pet: '布偶貓', desc: '浪漫夢幻的溫柔藝術家', emoji: '🐱'}
      },
      INFP: {
        aries: {pet: '美國短毛貓', desc: '理想勇敢，熱情追夢', emoji: '🐱'},
        taurus: {pet: '布偶貓', desc: '純真穩重，踏實陪伴', emoji: '🐱'},
        gemini: {pet: '康沃爾雷克斯貓', desc: '創意無限，奇思妙想', emoji: '🐱'},
        cancer: {pet: '喜馬拉雅貓', desc: '情感豐富，深層夢想', emoji: '🐱'},
        leo: {pet: '美國短毛貓', desc: '熱情理想，溫暖追求', emoji: '🐱'},
        virgo: {pet: '布偶貓', desc: '完美純真的理想主義者', emoji: '🐱'},
        libra: {pet: '康沃爾雷克斯貓', desc: '和諧創意的藝術夢想家', emoji: '🐱'},
        scorpio: {pet: '喜馬拉雅貓', desc: '深沉感性的靈魂詩人', emoji: '🐱'},
        sagittarius: {pet: '美國短毛貓', desc: '自由樂觀的理想探索者', emoji: '🐱'},
        capricorn: {pet: '布偶貓', desc: '務實溫柔的夢想建造者', emoji: '🐱'},
        aquarius: {pet: '康沃爾雷克斯貓', desc: '獨立前衛的未來夢想家', emoji: '🐱'},
        pisces: {pet: '喜馬拉雅貓', desc: '浪漫夢幻的情感詩人', emoji: '🐱'}
      },
      INTP: {
        aries: {pet: '阿比西尼亞貓', desc: '聰明勇敢，創意冒險', emoji: '🐱'},
        taurus: {pet: '英國短毛貓', desc: '理性穩重，分析完美', emoji: '🐱'},
        gemini: {pet: '暹羅貓', desc: '機智靈活，好奇探索', emoji: '🐱'},
        cancer: {pet: '俄羅斯藍貓', desc: '理性感性，深度思考', emoji: '🐱'},
        leo: {pet: '阿比西尼亞貓', desc: '自信聰明，創意領導', emoji: '🐱'},
        virgo: {pet: '英國短毛貓', desc: '完美分析的理性思考者', emoji: '🐱'},
        libra: {pet: '暹羅貓', desc: '平衡理性的智慧探索者', emoji: '🐱'},
        scorpio: {pet: '俄羅斯藍貓', desc: '深沉理性的神秘思考者', emoji: '🐱'},
        sagittarius: {pet: '阿比西尼亞貓', desc: '自由探索的智慧冒險家', emoji: '🐱'},
        capricorn: {pet: '英國短毛貓', desc: '務實理性的穩定分析師', emoji: '🐱'},
        aquarius: {pet: '暹羅貓', desc: '獨立創新的前瞻思考者', emoji: '🐱'},
        pisces: {pet: '俄羅斯藍貓', desc: '直覺理性的夢幻科學家', emoji: '🐱'}
      }
      // 其他 MBTI 類型省略，當找不到對應結果時，會使用 animals.json 中的通用結果
    };

    // 回退結果查找函數
    function findFallbackResult(mbti, element) {
      if (!animalData || animalData.length === 0) return null;
      
      // 先找完全匹配的 MBTI 和元素
      let result = animalData.find(animal => 
        animal.mbti === mbti && animal.element === element
      );
      
      // 如果找不到，只匹配 MBTI
      if (!result) {
        result = animalData.find(animal => animal.mbti === mbti);
      }
      
      // 如果還是找不到，找相近的 MBTI（同象限）
      if (!result) {
        const userGroup = Object.keys(mbtiGroups).find(group => 
          mbtiGroups[group].includes(mbti)
        );
        if (userGroup && mbtiGroups[userGroup]) {
          result = animalData.find(animal => 
            mbtiGroups[userGroup].includes(animal.mbti)
          );
        }
      }
      
      return result;
    }
    
    // 顯示回退結果
    function displayFallbackResult(animal, mbti, zodiacName) {
      const emoji = getAnimalEmoji(animal.species);
      const resultDiv = document.getElementById('result');
      
      resultDiv.innerHTML = `
        <div class="ig-result-card">
          <div class="stories-header">
            <div class="stories-profile">
              <div class="stories-avatar">✨</div>
              <div class="stories-info">
                <div class="stories-username">MBTI動物占卜</div>
                <div class="stories-time">現時動態</div>
              </div>
            </div>
            <div class="stories-options">⋯</div>
          </div>

          <div class="stories-content" style="flex: 1; display: flex; flex-direction: column; padding: 8px 16px; overflow: hidden;">
            <div class="decorative-hearts" style="position: absolute; top: 10px; right: 15px; opacity: 0.3;">💖</div>
            <div class="decorative-sparkles" style="position: absolute; top: 30px; left: 15px; opacity: 0.3;">✨</div>
          
            <div class="result-header" style="text-align: center; margin-bottom: 8px;">
              <div class="result-emoji-container" style="margin-bottom: 4px;">
                <div class="result-emoji" style="font-size: 2.5rem;">${emoji}</div>
              </div>
              <h2 class="result-title" style="font-size: 0.9rem; margin: 2px 0; color: #8B4513;">最像你的性格動物是</h2>
              <h3 class="result-pet-name" style="font-size: 1.1rem; margin: 2px 0; font-weight: 600;">${animal.species}</h3>
            </div>
            
            <p class="result-description" style="font-size: 0.75rem; line-height: 1.3; margin: 6px 0; text-align: center; color: #666;">${animal.description}</p>
            
            <div style="text-align: center; margin: 6px 0;">
              <div class="result-mbti-badge" style="font-size: 0.7rem; padding: 3px 8px;">✨ ${mbti} · ${zodiacName} ✨</div>
            </div>

            <div class="similar-animals" style="margin: 8px 0;">
              <div class="similar-title" style="font-size: 0.8rem; margin-bottom: 4px; text-align: center;">
                💫 個性相似的夥伴
              </div>
              <div class="animal-row" id="similar-animals-row">
                <!-- 動態載入相似動物 -->
              </div>
            </div>

            <div class="similar-animals" style="margin: 8px 0;">
              <div class="similar-title" style="font-size: 0.8rem; margin-bottom: 4px; text-align: center;">
                🌟 互補配對的朋友
              </div>
              <div class="animal-row" id="complementary-animals-row">
                <!-- 動態載入互補動物 -->
              </div>
            </div>

            <div class="social-connection" style="margin: 8px 0; text-align: center;">
              <div class="connection-text" style="font-size: 0.65rem; color: #8B4513; margin-bottom: 4px;">
                找到跟你一樣的朋友了嗎？快分享給他們看看！
              </div>
              <div class="connection-tags" style="display: flex; justify-content: center; gap: 4px; flex-wrap: wrap;">
                <span class="connection-tag" style="font-size: 0.6rem; padding: 2px 6px; background: rgba(244, 167, 185, 0.2); border-radius: 8px;">#MBTI</span>
                <span class="connection-tag" style="font-size: 0.6rem; padding: 2px 6px; background: rgba(244, 167, 185, 0.2); border-radius: 8px;">#個性測驗</span>
                <span class="connection-tag" style="font-size: 0.6rem; padding: 2px 6px; background: rgba(244, 167, 185, 0.2); border-radius: 8px;">#動物占卜</span>
              </div>
            </div>
            
            <div class="share-section" style="margin-top: auto; padding-top: 6px;">
              <div class="share-title" style="font-size: 0.7rem; text-align: center; margin-bottom: 6px;">📱 分享結果</div>
              <div class="share-buttons" style="display: flex; justify-content: center; gap: 6px; flex-wrap: wrap;">
                <button class="share-btn" onclick="shareToInstagram()" style="font-size: 0.6rem; padding: 4px 8px; border: 1px solid #ddd; border-radius: 12px; background: white;">
                  📷 IG
                </button>
                <button class="share-btn" onclick="shareToFacebook()" style="font-size: 0.6rem; padding: 4px 8px; border: 1px solid #ddd; border-radius: 12px; background: white;">
                  📘 FB  
                </button>
                <button class="share-btn" onclick="copyResult()" style="font-size: 0.6rem; padding: 4px 8px; border: 1px solid #ddd; border-radius: 12px; background: white;">
                  📋 複製連結
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
      
      resultDiv.style.display = 'block';
      resultDiv.style.opacity = '1';
      resultDiv.style.transform = 'translateY(0)';
      
      // 載入相似和互補動物
      setTimeout(() => {
        loadSimilarAnimals(mbti, currentUserResult.zodiac);
      }, 500);
      
      // 滾動到結果區域
      setTimeout(() => {
        resultDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 100);
    }

    // Generate multilingual result content
    function generateResultContent(matchingAnimal, mbti, zodiacName, emoji) {
      return `
        <div class="ig-result-card">
          <div class="stories-header">
            <div class="stories-profile">
              <div class="stories-avatar">✨</div>
              <div class="stories-info">
                <div class="stories-username inline">
                  <span data-zh>MBTI動物占卜</span>
                  <span data-en>MBTI Animal Oracle</span>
                </div>
                <div class="stories-time inline">
                  <span data-zh>現時動態</span>
                  <span data-en>Live Story</span>
                </div>
              </div>
            </div>
            <div class="stories-options">⋯</div>
          </div>

          <!-- 全部內容適配9:16，無滾動 -->
          <div class="stories-content" style="flex: 1; display: flex; flex-direction: column; padding: 8px 16px; overflow: hidden;">
            <div class="decorative-hearts" style="position: absolute; top: 10px; right: 15px; opacity: 0.3;">💖</div>
            <div class="decorative-sparkles" style="position: absolute; top: 30px; left: 15px; opacity: 0.3;">✨</div>
          
            <div class="result-header" style="text-align: center; margin-bottom: 8px;">
              <div class="result-emoji-container" style="margin-bottom: 4px;">
                <div class="result-emoji" style="font-size: 2.5rem;">${emoji}</div>
              </div>
              <h2 class="result-title inline" style="font-size: 0.9rem; margin: 2px 0; color: #8B4513;">
                <span data-zh>最像你的性格動物是</span>
                <span data-en>Your spirit animal is</span>
              </h2>
              <h3 class="result-pet-name" style="font-size: 1.1rem; margin: 2px 0; font-weight: 600;">${matchingAnimal.species}</h3>
            </div>
            
            <p class="result-description" style="font-size: 0.75rem; line-height: 1.3; margin: 6px 0; text-align: center; color: #666;">${matchingAnimal.description}</p>
            
            <div style="text-align: center; margin: 6px 0;">
              <div class="result-mbti-badge" style="font-size: 0.7rem; padding: 3px 8px;">✨ ${mbti} · ${zodiacName} ✨</div>
            </div>

            <!-- 相似動物區域 -->
            <div class="similar-animals" style="margin: 8px 0;">
              <div class="similar-title inline" style="font-size: 0.8rem; margin-bottom: 4px; text-align: center;">
                <span data-zh>💫 個性相似的夥伴</span>
                <span data-en>💫 Similar Personality Partners</span>
              </div>
              <div class="animal-row" id="similar-animals-row" style="display: flex; justify-content: space-around; gap: 4px;">
                <!-- 動態載入相似動物 -->
              </div>
            </div>

            <!-- 互補動物區域 -->
            <div class="similar-animals" style="margin: 8px 0;">
              <div class="similar-title inline" style="font-size: 0.8rem; margin-bottom: 4px; text-align: center;">
                <span data-zh>🌟 互補配對的朋友</span>
                <span data-en>🌟 Complementary Partners</span>
              </div>
              <div class="animal-row" id="complementary-animals-row" style="display: flex; justify-content: space-around; gap: 4px;">
                <!-- 動態載入互補動物 -->
              </div>
            </div>

            <!-- 社交連結提示 -->
            <div class="social-connection" style="margin: 8px 0; text-align: center;">
              <div class="connection-text inline" style="font-size: 0.65rem; color: #8B4513; margin-bottom: 4px;">
                <span data-zh>找到跟你一樣的朋友了嗎？快分享給他們看看！</span>
                <span data-en>Found friends like you? Share with them now!</span>
              </div>
              <div class="connection-tags" style="display: flex; justify-content: center; gap: 4px; flex-wrap: wrap;">
                <span class="connection-tag" style="font-size: 0.6rem; padding: 2px 6px; background: rgba(244, 167, 185, 0.2); border-radius: 8px;">#MBTI</span>
                <span class="connection-tag inline" style="font-size: 0.6rem; padding: 2px 6px; background: rgba(244, 167, 185, 0.2); border-radius: 8px;">
                  <span data-zh>#個性測驗</span>
                  <span data-en>#PersonalityTest</span>
                </span>
                <span class="connection-tag inline" style="font-size: 0.6rem; padding: 2px 6px; background: rgba(244, 167, 185, 0.2); border-radius: 8px;">
                  <span data-zh>#動物占卜</span>
                  <span data-en>#AnimalOracle</span>
                </span>
              </div>
            </div>
            
            <div class="share-section" style="margin-top: auto; padding-top: 6px;">
              <div class="share-title inline" style="font-size: 0.7rem; text-align: center; margin-bottom: 6px;">
                <span data-zh>📱 分享結果</span>
                <span data-en>📱 Share Results</span>
              </div>
              <div class="share-buttons" style="display: flex; justify-content: center; gap: 6px; flex-wrap: wrap;">
                <button class="share-btn" onclick="shareToInstagram()" style="font-size: 0.6rem; padding: 4px 8px; border: 1px solid #ddd; border-radius: 12px; background: white;">
                  📷 IG
                </button>
                <button class="share-btn" onclick="shareToFacebook()" style="font-size: 0.6rem; padding: 4px 8px; border: 1px solid #ddd; border-radius: 12px; background: white;">
                  📘 FB  
                </button>
                <button class="share-btn" onclick="copyResult()" style="font-size: 0.6rem; padding: 4px 8px; border: 1px solid #ddd; border-radius: 12px; background: white;">
                  <span class="inline">
                    <span data-zh>📋 複製連結</span>
                    <span data-en>📋 Copy Link</span>
                  </span>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 外部分享區域 -->
        <div class="external-share-section">
          <div class="external-share-title inline">
            <span data-zh>分享你的結果</span>
            <span data-en>Share Your Results</span>
          </div>
          <div class="share-subtitle inline">
            <span data-zh>讓朋友們也來看看他們最像什麼動物吧！</span>
            <span data-en>Let your friends discover their spirit animals too!</span>
          </div>
          <div class="share-buttons-grid">
            <button class="share-btn-external download-btn" onclick="downloadResult()">
              <span class="inline">
                <span data-zh>下載結果圖片</span>
                <span data-en>Download Result Image</span>
              </span>
            </button>
            <button class="share-btn-external" onclick="shareToInstagram()">
              Instagram 
              <span class="inline">
                <span data-zh>限時動態</span>
                <span data-en>Stories</span>
              </span>
            </button>
            <button class="share-btn-external" onclick="shareToFacebook()">
              Facebook 
              <span class="inline">
                <span data-zh>動態</span>
                <span data-en>Post</span>
              </span>
            </button>
            <button class="share-btn-external" onclick="shareToTwitter()">
              Twitter 
              <span class="inline">
                <span data-zh>推文</span>
                <span data-en>Tweet</span>
              </span>
            </button>
            <button class="share-btn-external" onclick="shareToLine()">
              LINE 
              <span class="inline">
                <span data-zh>聊天</span>
                <span data-en>Chat</span>
              </span>
            </button>
            <button class="share-btn-external" onclick="shareToWhatsApp()">
              WhatsApp 
              <span class="inline">
                <span data-zh">訊息</span>
                <span data-en>Message</span>
              </span>
            </button>
            <button class="share-btn-external" onclick="shareToTelegram()">
              Telegram 
              <span class="inline">
                <span data-zh>訊息</span>
                <span data-en>Message</span>
              </span>
            </button>
            <button class="share-btn-external" onclick="copyResult()">
              <span class="inline">
                <span data-zh>複製測驗連結</span>
                <span data-en>Copy Quiz Link</span>
              </span>
            </button>
          </div>
        </div>
      `;
    }
    
    function showResult() {
      console.log('showResult 函數被調用');
      
      const formData = new FormData(form);
      const mbti = formData.get('q1') + formData.get('q2') + formData.get('q3') + formData.get('q4');
      const zodiac = formData.get('q5');
      
      console.log('MBTI:', mbti, 'Zodiac:', zodiac);
      
      // 取得星座的中文名稱和對應元素
      const zodiacName = getZodiacName(zodiac);
      const element = getZodiacElement(zodiac);
      
      console.log('Element from zodiac:', element);
      
      // 儲存使用者結果供篩選使用  
      currentUserResult = {
        mbti: mbti,
        zodiac: zodiac,
        zodiacName: zodiacName,
        element: element
      };
      
      // 從 animals.json 找到對應的動物
      const matchingAnimal = findAnimalByMbtiAndElement(mbti, element);
      
      if (!matchingAnimal) {
        console.error('找不到對應的動物, MBTI:', mbti, 'Element:', element);
        return;
      }
      
      console.log('找到匹配動物:', matchingAnimal);
      
      const resultDiv = document.getElementById('result');
      if (!resultDiv) {
        console.error('找不到 result div');
        return;
      }
      
      // 取得動物表情符號
      const emoji = getAnimalEmoji(matchingAnimal.species);
      
      try {
        // Use the new multilingual content generator
        resultDiv.innerHTML = generateResultContent(matchingAnimal, mbti, zodiacName, emoji);
        
        console.log('IG 風格 HTML 內容已設置');
        
        // 直接顯示結果，隱藏表單
        document.getElementById('quizForm').style.display = 'none';
        document.getElementById('result').style.display = 'block';
        
        // 載入相似動物
        setTimeout(() => {
          loadSimilarAnimals(matchingAnimal.mbti);
          loadComplementaryAnimals(matchingAnimal.mbti);
        }, 100);
        
      } catch (error) {
        console.error('設置結果內容時發生錯誤:', error);
      }
    }
    
    // 社群媒體分享功能
    function shareToInstagram() {
      const text = `🐱🐶 我完成了性格動物測驗！\n\n我最像的是：${currentUserResult ? getCurrentResultText() : '神秘動物'}\n\nMBTI: ${currentUserResult ? currentUserResult.mbti : 'Unknown'} · ${currentUserResult ? currentUserResult.zodiacName : 'Unknown'}\n\n你也來測測看吧！ 🌟\n\n#MBTI #性格測驗 #動物性格 #心理測驗`;
      
      navigator.clipboard.writeText(text).then(() => {
        showNotification('✨ 文字已複製！快去 Instagram 分享吧！', 'success');
        playClickSound();
      }).catch(() => {
        showNotification('❌ 複製失敗，請手動複製', 'error');
      });
    }
    
    function shareToFacebook() {
      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent('🐱🐶 我完成了性格動物測驗！快來看看你最像哪種毛孩！');
      const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`;
      
      window.open(shareUrl, '_blank', 'width=600,height=400');
      playClickSound();
    }
    
    function shareToTwitter() {
      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent(`🐱🐶 我完成了性格動物測驗！我最像的是：${currentUserResult ? getCurrentResultText() : '神秘動物'} (${currentUserResult ? currentUserResult.mbti : 'Unknown'} · ${currentUserResult ? currentUserResult.zodiacName : 'Unknown'}) 你也來測測看吧！ 🌟 #MBTI #性格測驗`);
      const shareUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
      
      window.open(shareUrl, '_blank', 'width=600,height=400');
      playClickSound();
    }
    
    function shareToLine() {
      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent(`🐱🐶 我完成了性格動物測驗！\n我最像的是：${currentUserResult ? getCurrentResultText() : '神秘動物'}\nMBTI: ${currentUserResult ? currentUserResult.mbti : 'Unknown'} · ${currentUserResult ? currentUserResult.zodiacName : 'Unknown'}\n你也來測測看吧！ 🌟`);
      const shareUrl = `https://social-plugins.line.me/lineit/share?url=${url}&text=${text}`;
      
      window.open(shareUrl, '_blank', 'width=600,height=400');
      playClickSound();
    }
    
    function shareToWhatsApp() {
      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent(`🐱🐶 我完成了性格動物測驗！\n我最像的是：${currentUserResult ? getCurrentResultText() : '神秘動物'}\nMBTI: ${currentUserResult ? currentUserResult.mbti : 'Unknown'} · ${currentUserResult ? currentUserResult.zodiacName : 'Unknown'}\n你也來測測看吧！ 🌟\n\n${decodeURIComponent(url)}`);
      const shareUrl = `https://wa.me/?text=${text}`;
      
      window.open(shareUrl, '_blank');
      playClickSound();
    }
    
    function shareToTelegram() {
      const url = encodeURIComponent(window.location.href);
      const text = encodeURIComponent(`🐱🐶 我完成了性格動物測驗！\n我最像的是：${currentUserResult ? getCurrentResultText() : '神秘動物'}\nMBTI: ${currentUserResult ? currentUserResult.mbti : 'Unknown'} · ${currentUserResult ? currentUserResult.zodiacName : 'Unknown'}\n你也來測測看吧！ 🌟`);
      const shareUrl = `https://t.me/share/url?url=${url}&text=${text}`;
      
      window.open(shareUrl, '_blank', 'width=600,height=400');
      playClickSound();
    }
    
    // 下載結果圖片功能
    async function downloadResult() {
      try {
        showNotification('🎨 正在生成結果圖片...', 'info');
        playClickSound();
        
        const resultCard = document.querySelector('.ig-result-card');
        if (!resultCard) {
          showNotification('❌ 找不到結果卡片', 'error');
          return;
        }
        
        // 使用 html2canvas 截圖（需要先載入這個庫）
        if (typeof html2canvas !== 'undefined') {
          const canvas = await html2canvas(resultCard, {
            backgroundColor: '#ffffff',
            scale: 2, // 高品質
            useCORS: true,
            allowTaint: true
          });
          
          // 創建下載連結
          const link = document.createElement('a');
          link.download = `MBTI動物測驗結果-${currentUserResult ? currentUserResult.mbti : 'result'}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
          
          showNotification('✅ 結果圖片已下載！', 'success');
        } else {
          // 備用方案：提示用戶手動截圖
          showNotification('📱 請手動截圖保存結果喔！', 'info');
        }
      } catch (error) {
        console.error('下載失敗:', error);
        showNotification('📱 請手動截圖保存結果喔！', 'info');
      }
    }
    
    function copyResult() {
      const url = window.location.href;
      const text = `🐱🐶 我完成了性格動物測驗！\n\n我最像的是：${currentUserResult ? getCurrentResultText() : '神秘動物'}\nMBTI: ${currentUserResult ? currentUserResult.mbti : 'Unknown'} · ${currentUserResult ? currentUserResult.zodiacName : 'Unknown'}\n\n你也來測測看吧！ 🌟\n\n${url}`;
      
      navigator.clipboard.writeText(text).then(() => {
        showNotification('📋 結果連結已複製！', 'success');
        playClickSound();
      }).catch(() => {
        const textArea = document.createElement('textarea');
        textArea.value = text;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          showNotification('📋 結果連結已複製！', 'success');
          playClickSound();
        } catch (err) {
          showNotification('❌ 複製失敗，請手動複製', 'error');
        }
        document.body.removeChild(textArea);
      });
    }
    
    function getCurrentResultText() {
      if (!currentUserResult) return '神秘動物';
      
      const matchingAnimal = findAnimalByMbtiAndElement(currentUserResult.mbti, currentUserResult.element);
      if (matchingAnimal) {
        return matchingAnimal.species;
      }
      
      return '神秘動物';
    }
    
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.textContent = message;
      
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' : 'linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%)'};
        color: white;
        padding: 15px 20px;
        border-radius: 12px;
        font-family: 'Inter', 'Noto Sans TC', sans-serif;
        font-size: 0.9rem;
        font-weight: 500;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        z-index: 10000;
        animation: slideInRight 0.3s ease-out;
        max-width: 300px;
        word-wrap: break-word;
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease-in forwards';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }
    
    // 顯示探索更多區域
    function showExploreMore() {
      playClickSound();
      
      const exploreDiv = document.getElementById('exploreMore');
      exploreDiv.style.display = 'block';
      
      // 初始化篩選器
      setupFilters();
      
      // 顯示所有動物（按相似度排序）
      const filtered = filterAnimals('all', 'all', 'all');
      displayAnimals(filtered, currentUserResult.mbti, currentUserResult.zodiac);
      
      // 滾動到探索區域
      setTimeout(() => {
        exploreDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 300);
    }

    // 初始化音頻上下文（需要用戶交互）
    document.addEventListener('click', function initAudio() {
      if (audioContext.state === 'suspended') {
        audioContext.resume();
      }
      document.removeEventListener('click', initAudio);
    }, { once: true });
    
    // 頁面載入完成後初始化
    // 載入相似和互補動物
    function loadSimilarAnimals(currentMbti, currentZodiac) {
      console.log('載入相似動物，MBTI:', currentMbti, '星座:', currentZodiac);
      
      if (!animalData || animalData.length === 0) {
        console.log('動物資料尚未載入，等待載入...');
        // 等待動物資料載入後再次嘗試
        setTimeout(() => {
          if (animalData && animalData.length > 0) {
            loadSimilarAnimals(currentMbti, currentZodiac);
          }
        }, 1000);
        return;
      }

      console.log('動物資料已載入，共', animalData.length, '個動物');

      // 找出相似動物 - 同樣 MBTI 的其他對象（3個）
      const similarAnimals = animalData.filter(animal => {
        return animal.mbti === currentMbti && getZodiacElement(animal.element) !== getZodiacElement(currentZodiac);
      }).slice(0, 3);

      // 找出互補動物 - MBTI 完全相反的（4個）
      const complementaryAnimals = animalData.filter(animal => {
        if (!animal.mbti || animal.mbti === currentMbti || animal.mbti.length !== 4) return false;
        
        // 計算 MBTI 相反程度
        let oppositeCount = 0;
        const mbtiPairs = [
          ['E', 'I'], ['S', 'N'], ['T', 'F'], ['J', 'P']
        ];
        
        for (let i = 0; i < 4; i++) {
          const userChar = currentMbti[i];
          const animalChar = animal.mbti[i];
          
          // 檢查是否為相反特質
          for (const pair of mbtiPairs) {
            if ((pair[0] === userChar && pair[1] === animalChar) || 
                (pair[1] === userChar && pair[0] === animalChar)) {
              oppositeCount++;
              break;
            }
          }
        }
        
        // 至少3個特質相反才算互補
        return oppositeCount >= 3;
      }).slice(0, 4);

      console.log('找到相似動物:', similarAnimals.length, '個');
      console.log('找到互補動物:', complementaryAnimals.length, '個');

      // 渲染相似動物
      const similarRow = document.getElementById('similar-animals-row');
      if (similarRow) {
        if (similarAnimals.length > 0) {
          similarRow.innerHTML = similarAnimals.map(animal => {
            // 根據 MBTI 第一個字母決定表情符號：I = 貓，E = 狗
            const emoji = animal.mbti && animal.mbti[0] === 'I' ? '🐱' : '🐶';
            
            return `
              <div class="mini-animal" style="display: flex; flex-direction: column; align-items: center; min-width: 0; flex: 1;">
                <div class="mini-animal-emoji" style="font-size: 1.2rem; margin-bottom: 2px;">${emoji}</div>
                <div class="mini-animal-name" style="font-size: 0.55rem; color: #666; text-align: center; line-height: 1.1; max-width: 60px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${animal.species.split(' ')[0]}</div>
                <div class="mini-animal-type" style="font-size: 0.5rem; color: #999; margin-top: 1px;">${animal.mbti}</div>
              </div>
            `;
          }).join('');
          console.log('相似動物已渲染');
        } else {
          similarRow.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.8rem;">暫無相似動物</div>';
        }
      } else {
        console.log('找不到 similar-animals-row 元素');
      }

      // 渲染互補動物
      const complementaryRow = document.getElementById('complementary-animals-row');
      if (complementaryRow) {
        if (complementaryAnimals.length > 0) {
          complementaryRow.innerHTML = complementaryAnimals.map(animal => {
            // 根據 MBTI 第一個字母決定表情符號：I = 貓，E = 狗
            const emoji = animal.mbti && animal.mbti[0] === 'I' ? '🐱' : '🐶';
            
            return `
              <div class="mini-animal" style="display: flex; flex-direction: column; align-items: center; min-width: 0; flex: 1;">
                <div class="mini-animal-emoji" style="font-size: 1.2rem; margin-bottom: 2px;">${emoji}</div>
                <div class="mini-animal-name" style="font-size: 0.55rem; color: #666; text-align: center; line-height: 1.1; max-width: 60px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${animal.species.split(' ')[0]}</div>
                <div class="mini-animal-type" style="font-size: 0.5rem; color: #999; margin-top: 1px;">${animal.mbti}</div>
              </div>
            `;
          }).join('');
          console.log('互補動物已渲染');
        } else {
          complementaryRow.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.8rem;">暫無互補動物</div>';
        }
      } else {
        console.log('找不到 complementary-animals-row 元素');
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      loadAnimalData();
      
      // 添加動畫樣式
      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideInRight {
          from { transform: translateX(100%); opacity: 0; }
          to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOutRight {
          from { transform: translateX(0); opacity: 1; }
          to { transform: translateX(100%); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
    });

    // 簡化版相似和互補動物載入函數 - 專為9:16比例優化
    function loadSimilarAnimalsSimplified(currentMbti, currentZodiac) {
      if (!animalData || animalData.length === 0) {
        setTimeout(() => {
          if (animalData && animalData.length > 0) {
            loadSimilarAnimalsSimplified(currentMbti, currentZodiac);
          }
        }, 1000);
        return;
      }

      // 找出相似動物 - 完全相同的MBTI類型（排除自己）
      const similarAnimals = animalData.filter(animal => 
        animal.mbti === currentMbti
      ).slice(0, 3); // 只取3個

      // 找出互補動物 - 完全相反的MBTI類型
      const complementaryAnimals = animalData.filter(animal => {
        if (!animal.mbti || animal.mbti.length !== 4 || currentMbti.length !== 4) return false;
        
        // 檢查每個位置是否相反
        let oppositeCount = 0;
        for (let i = 0; i < 4; i++) {
          const userChar = currentMbti[i];
          const animalChar = animal.mbti[i];
          
          // 檢查是否為相反特質
          if ((userChar === 'I' && animalChar === 'E') ||
              (userChar === 'E' && animalChar === 'I') ||
              (userChar === 'S' && animalChar === 'N') ||
              (userChar === 'N' && animalChar === 'S') ||
              (userChar === 'T' && animalChar === 'F') ||
              (userChar === 'F' && animalChar === 'T') ||
              (userChar === 'J' && animalChar === 'P') ||
              (userChar === 'P' && animalChar === 'J')) {
            oppositeCount++;
          }
        }
        
        // 4個特質都相反才算完全互補
        return oppositeCount === 4;
      }).slice(0, 3); // 只取3個

      console.log('當前MBTI:', currentMbti);
      console.log('找到相似動物:', similarAnimals.length, '個');
      console.log('找到互補動物:', complementaryAnimals.length, '個');

      // 渲染相似動物
      const similarRow = document.getElementById('similar-animals-row');
      if (similarRow) {
        if (similarAnimals.length > 0) {
          similarRow.innerHTML = similarAnimals.map(animal => {
            const emoji = getAnimalEmoji(animal.species);
            const shortName = animal.species.length > 4 ? animal.species.substring(0, 3) + '..' : animal.species;
            
            return `
              <div style="display: flex; flex-direction: column; align-items: center; min-width: 0; flex: 1; max-width: 50px;">
                <div style="font-size: 0.9rem; margin-bottom: 1px;">${emoji}</div>
                <div style="font-size: 0.5rem; color: #666; text-align: center; line-height: 1; word-break: break-all;">${shortName}</div>
                <div style="font-size: 0.45rem; color: #999;">${animal.mbti}</div>
              </div>
            `;
          }).join('');
        } else {
          similarRow.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.6rem; padding: 8px 0;">暫無相同類型</div>';
        }
      }

      // 渲染互補動物
      const complementaryRow = document.getElementById('complementary-animals-row');
      if (complementaryRow) {
        if (complementaryAnimals.length > 0) {
          complementaryRow.innerHTML = complementaryAnimals.map(animal => {
            const emoji = getAnimalEmoji(animal.species);
            const shortName = animal.species.length > 4 ? animal.species.substring(0, 3) + '..' : animal.species;
            
            return `
              <div style="display: flex; flex-direction: column; align-items: center; min-width: 0; flex: 1; max-width: 50px;">
                <div style="font-size: 0.9rem; margin-bottom: 1px;">${emoji}</div>
                <div style="font-size: 0.5rem; color: #666; text-align: center; line-height: 1; word-break: break-all;">${shortName}</div>
                <div style="font-size: 0.45rem; color: #999;">${animal.mbti}</div>
              </div>
            `;
          }).join('');
        } else {
          complementaryRow.innerHTML = '<div style="text-align: center; color: #999; font-size: 0.6rem; padding: 8px 0;">暫無互補類型</div>';
        }
      }
    }

    // Language Translation System
    const translations = {
      'zh-TW': {
        btnTextReady: '開始測驗',
        btnTextComplete: '請完成所有題目',
        resultNoMatch: '暫無互補類型',
        exploreMore: '🔍 探索更多相似的毛孩',
        shareText: '我在MBTI動物測驗中是',
        downloadText: '下載結果圖片',
        retakeText: '重新測驗',
        yourResult: '你的測驗結果：',
        mbtiType: 'MBTI 類型：',
        zodiacSign: '星座：',
        perfectMatch: '你的完美動物夥伴是：',
        similarAnimals: '相似的動物夥伴',
        complementaryAnimals: '互補的動物夥伴',
        personalityTraits: '性格特質：',
        lifeStyle: '生活風格：',
        relationship: '人際關係：',
        career: '適合職業：'
      },
      'en-US': {
        btnTextReady: 'View Results',
        btnTextComplete: 'Please complete all questions',
        resultNoMatch: 'No complementary types',
        exploreMore: '🔍 Explore More Similar Pets',
        shareText: 'I am',
        downloadText: 'Download Result',
        retakeText: 'Retake Quiz',
        yourResult: 'Your Quiz Result:',
        mbtiType: 'MBTI Type:',
        zodiacSign: 'Zodiac Sign:',
        perfectMatch: 'Your perfect animal companion is:',
        similarAnimals: 'Similar Animal Partners',
        complementaryAnimals: 'Complementary Animal Partners',
        personalityTraits: 'Personality Traits:',
        lifeStyle: 'Lifestyle:',
        relationship: 'Relationships:',
        career: 'Suitable Careers:'
      }
    };

    // Language switching functionality
    function switchLanguage(langCode) {
      const html = document.documentElement;
      html.setAttribute('data-lang', langCode);
      
      // Update active button
      document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang-code') === langCode) {
          btn.classList.add('active');
        }
      });

      // Update document language
      html.setAttribute('lang', langCode === 'zh-TW' ? 'zh-Hant' : 'en-US');
      
      // Update page title
      const currentTranslations = translations[langCode];
      if (langCode === 'en-US') {
        document.title = '🐱🐶 MBTI Animal Personality Test | Find Your Spirit Animal';
      } else {
        document.title = '🐱🐶 發現最像你的性格動物 | MBTI性格測驗';
      }

      // Store language preference
      localStorage.setItem('preferred-language', langCode);

      // Update dynamic content if quiz is completed
      updateDynamicContent(langCode);
    }

    // Update dynamic content based on language
    function updateDynamicContent(langCode) {
      const currentTranslations = translations[langCode];
      
      // Update button text
      const submitBtn = document.getElementById('submitBtn');
      const btnText = document.getElementById('btnText');
      if (submitBtn && btnText) {
        const allAnswered = Array.from(document.querySelectorAll('input[type="radio"]:checked')).length === 5;
        if (allAnswered) {
          btnText.innerHTML = `
            <span data-zh>查看結果</span>
            <span data-en>View Results</span>
          `;
        } else {
          btnText.innerHTML = `
            <span data-zh>請完成所有題目</span>
            <span data-en>Please complete all questions</span>
          `;
        }
      }
    }

    // Detect user's preferred language
    function detectLanguage() {
      // Check if user has a stored preference
      const storedLang = localStorage.getItem('preferred-language');
      if (storedLang && (storedLang === 'zh-TW' || storedLang === 'en-US')) {
        return storedLang;
      }

      // Detect browser language
      const browserLang = navigator.language || navigator.userLanguage;
      
      // Check for Chinese variants
      if (browserLang.includes('zh')) {
        return 'zh-TW';
      }
      
      // Default to English for other languages
      return 'en-US';
    }

    // Initialize language on page load
    document.addEventListener('DOMContentLoaded', function() {
      const preferredLang = detectLanguage();
      switchLanguage(preferredLang);
    });

    // Add to existing window load event
    const originalWindowLoad = window.onload;
    window.onload = function() {
      if (originalWindowLoad) originalWindowLoad();
      
      // Initialize language
      const preferredLang = detectLanguage();
      switchLanguage(preferredLang);
    };
  </script>
</body>
</html>

